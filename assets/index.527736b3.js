var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,u=(e,t)=>{for(var r in t||(t={}))s.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&o(e,r,t[r]);return e};import{a as l,v as i,s as c,l as f,i as h,t as p,b as v,r as d,w as y,o as g,c as m,d as x,u as b,e as w,F as A,f as P,g as C,h as M,p as k,P as _,j}from"./vendor.6f7a1c23.js";class S extends Error{constructor(e,t){super(e),this.info=t,Error.captureStackTrace&&Error.captureStackTrace(this,S)}}class O extends S{constructor(e,t){super(e,t)}}class $ extends S{constructor(e,t){super(e,t)}}class E extends ${constructor(e,t){super(e,t)}}var T=Object.defineProperty,N=Object.getOwnPropertyDescriptor,D=(e,t,r,n)=>{for(var s,a=n>1?void 0:n?N(t,r):t,o=e.length-1;o>=0;o--)(s=e[o])&&(a=(n?s(t,r,a):s(a))||a);return n&&a&&T(t,r,a),a};const F=class{constructor(e=[],t,r){this.opts={},this.layerdStates=e,this.parent=t,this.name=r||(1===e.length?"<root>":"<anonymous>")}log(e,t){this.parent?this.parent.log(e,t):this.opts.log&&this.opts.log(e,t)}onUpdated(e,t){this.parent?this.parent.onUpdated(e,t):this.opts.onUpdated&&this.opts.onUpdated(e,t)}createChildScope(e=new Map,t){const r=[e,...this.layerdStates];return new F(r,this,t)}get(e){for(const t of this.layerdStates)if(t.has(e)){const r=t.get(e);return this.log("read",{var:e,val:r}),r}throw new $(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}getAll(){const e=this.layerdStates.reduce(((e,t)=>[...e,...t]),[]);return new Map(e)}add(e,t){this.log("add",{var:e,val:t});const r=this.layerdStates[0];if(r.has(e))throw new $(`Variable '${e}' is alerady exists in scope '${this.name}'`,{scope:this.layerdStates});r.set(e,t),null==this.parent&&this.onUpdated(e,t)}assign(e,t){let r=1;for(const n of this.layerdStates){if(n.has(e))return n.set(e,t),this.log("assign",{var:e,val:t}),void(r===this.layerdStates.length&&this.onUpdated(e,t));r++}throw new $(`No such variable '${e}' in scope '${this.name}'`,{scope:this.layerdStates})}};let H=F;D([l],H.prototype,"log",1),D([l],H.prototype,"onUpdated",1),D([l],H.prototype,"createChildScope",1),D([l],H.prototype,"get",1),D([l],H.prototype,"getAll",1),D([l],H.prototype,"add",1),D([l],H.prototype,"assign",1);const I={type:"null"},q={type:"bool",value:!0},z={type:"bool",value:!1},U=e=>({type:"num",value:e}),R=e=>({type:"str",value:e}),L=e=>({type:"bool",value:e}),J=e=>({type:"obj",value:e}),Z=e=>({type:"arr",value:e}),B=e=>({type:"fn",native:e});function G(e){if(null==e)throw new $("Expect anything, but got nothing.")}function Q(e){if(null==e)throw new $("Expect boolean, but got nothing.");if("bool"!==e.type)throw new $(`Expect boolean, but got ${e.type}.`)}function V(e){if(null==e)throw new $("Expect function, but got nothing.");if("fn"!==e.type)throw new $(`Expect function, but got ${e.type}.`)}function Y(e){if(null==e)throw new $("Expect string, but got nothing.");if("str"!==e.type)throw new $(`Expect string, but got ${e.type}.`)}function K(e){if(null==e)throw new $("Expect number, but got nothing.");if("num"!==e.type)throw new $(`Expect number, but got ${e.type}.`)}function W(e){if(null==e)throw new $("Expect object, but got nothing.");if("obj"!==e.type)throw new $(`Expect object, but got ${e.type}.`)}function X(e){if(null==e)throw new $("Expect array, but got nothing.");if("arr"!==e.type)throw new $(`Expect array, but got ${e.type}.`)}function ee(e,t){return"fn"!==e.type&&"fn"!==t.type&&("null"===e.type&&"null"===t.type||"null"!==e.type&&"null"!==t.type&&e.value===t.value)}function te(e,t=!1){if(t){if("num"===e.type)return e.value.toString();if("bool"===e.type)return e.value?"true":"false";if("str"===e.type)return`"${e.value}"`;if("arr"===e.type)return`[${e.value.map((e=>te(e,!0))).join(", ")}]`;if("null"===e.type)return"(null)"}const r="num"===e.type||"bool"===e.type?e.value:"str"===e.type?`"${e.value}"`:"fn"===e.type||"obj"===e.type?"...":"null"===e.type?"":null;return`${e.type}<${r}>`}function re(e){switch(e.type){case"fn":return"<function>";case"arr":return e.value.map((e=>re(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const t={};for(const[r,n]of e.value.entries())t[r]=re(n);return t}case"str":return e.value;default:throw new Error(`Unrecognized value type: ${e.type}`)}}function ne(e){if(null===e)return I;if("boolean"==typeof e)return L(e);if("string"==typeof e)return R(e);if("number"==typeof e)return U(e);if(Array.isArray(e))return Z(e.map((e=>ne(e))));if("object"==typeof e){const t=new Map;for(const[r,n]of Object.entries(e))t.set(r,ne(n));return J(t)}return I}function se(e,t=!1,r=new Set){var n;if(("arr"===e.type||"obj"===e.type)&&r.has(e.value))return"...";if(t&&"str"===e.type)return'"'+e.value.replace(/["\\\r\n]/g,(e=>`\\${e}`))+'"';if("str"===e.type)return e.value;if("num"===e.type)return e.value.toString();if("arr"===e.type){r.add(e.value);const t=[];for(const n of e.value)t.push(se(n,!0,r));return"[ "+t.join(", ")+" ]"}if("obj"===e.type){r.add(e.value);const t=[];for(const[n,s]of e.value)t.push(`${n}: ${se(s,!0,r)}`);return"{ "+t.join(", ")+" }"}return"bool"===e.type?e.value.toString():"null"===e.type?"null":"fn"===e.type?`@( ${(null!=(n=e.args)?n:[]).join(", ")} ) { ... }`:"?"}const ae={help:R("SEE: https://github.com/syuilo/aiscript/blob/master/docs/get-started.md"),"Core:v":R("0.15.0"),"Core:ai":R("kawaii"),"Core:not":B((([e])=>(Q(e),e.value?z:q))),"Core:eq":B((([e,t])=>(G(e),G(t),ee(e,t)?q:z))),"Core:neq":B((([e,t])=>(G(e),G(t),ee(e,t)?z:q))),"Core:and":B((([e,t])=>(Q(e),e.value?(Q(t),t.value?q:z):z))),"Core:or":B((([e,t])=>(Q(e),e.value?q:(Q(t),t.value?q:z)))),"Core:add":B((([e,t])=>(K(e),K(t),U(e.value+t.value)))),"Core:sub":B((([e,t])=>(K(e),K(t),U(e.value-t.value)))),"Core:mul":B((([e,t])=>(K(e),K(t),U(e.value*t.value)))),"Core:pow":B((([e,t])=>{K(e),K(t);const r=e.value**t.value;if(isNaN(r))throw new $("Invalid operation.");return U(r)})),"Core:div":B((([e,t])=>{K(e),K(t);const r=e.value/t.value;if(isNaN(r))throw new $("Invalid operation.");return U(r)})),"Core:mod":B((([e,t])=>(K(e),K(t),U(e.value%t.value)))),"Core:gt":B((([e,t])=>(K(e),K(t),e.value>t.value?q:z))),"Core:lt":B((([e,t])=>(K(e),K(t),e.value<t.value?q:z))),"Core:gteq":B((([e,t])=>(K(e),K(t),e.value>=t.value?q:z))),"Core:lteq":B((([e,t])=>(K(e),K(t),e.value<=t.value?q:z))),"Core:type":B((([e])=>(G(e),R(e.type)))),"Core:to_str":B((([e])=>(G(e),R(se(e))))),"Core:range":B((([e,t])=>(K(e),K(t),e.value<t.value?Z(Array.from({length:t.value-e.value+1},((t,r)=>U(r+e.value)))):e.value>t.value?Z(Array.from({length:e.value-t.value+1},((t,r)=>U(e.value-r)))):Z([e])))),"Core:sleep":B((async([e])=>(K(e),await new Promise((t=>setTimeout(t,e.value))),I))),"Util:uuid":B((()=>R(i()))),"Json:stringify":B((([e])=>(G(e),R(JSON.stringify(re(e)))))),"Json:parse":B((([e])=>(Y(e),ne(JSON.parse(e.value))))),"Json:parsable":B((([e])=>{Y(e);try{JSON.parse(e.value)}catch(t){return L(!1)}return L(!0)})),"Date:now":B((()=>U(Date.now()))),"Date:year":B((([e])=>(e&&K(e),U(new Date((null==e?void 0:e.value)||Date.now()).getFullYear())))),"Date:month":B((([e])=>(e&&K(e),U(new Date((null==e?void 0:e.value)||Date.now()).getMonth()+1)))),"Date:day":B((([e])=>(e&&K(e),U(new Date((null==e?void 0:e.value)||Date.now()).getDate())))),"Date:hour":B((([e])=>(e&&K(e),U(new Date((null==e?void 0:e.value)||Date.now()).getHours())))),"Date:minute":B((([e])=>(e&&K(e),U(new Date((null==e?void 0:e.value)||Date.now()).getMinutes())))),"Date:second":B((([e])=>(e&&K(e),U(new Date((null==e?void 0:e.value)||Date.now()).getSeconds())))),"Date:parse":B((([e])=>(Y(e),U(new Date(e.value).getTime())))),"Math:Infinity":U(1/0),"Math:E":U(Math.E),"Math:LN2":U(Math.LN2),"Math:LN10":U(Math.LN10),"Math:LOG2E":U(Math.LOG2E),"Math:LOG10E":U(Math.LOG10E),"Math:PI":U(Math.PI),"Math:SQRT1_2":U(Math.SQRT1_2),"Math:SQRT2":U(Math.SQRT2),"Math:abs":B((([e])=>(K(e),U(Math.abs(e.value))))),"Math:acos":B((([e])=>(K(e),U(Math.acos(e.value))))),"Math:acosh":B((([e])=>(K(e),U(Math.acosh(e.value))))),"Math:asin":B((([e])=>(K(e),U(Math.asin(e.value))))),"Math:asinh":B((([e])=>(K(e),U(Math.asinh(e.value))))),"Math:atan":B((([e])=>(K(e),U(Math.atan(e.value))))),"Math:atanh":B((([e])=>(K(e),U(Math.atanh(e.value))))),"Math:atan2":B((([e,t])=>(K(e),K(t),U(Math.atan2(e.value,t.value))))),"Math:cbrt":B((([e])=>(K(e),U(Math.cbrt(e.value))))),"Math:ceil":B((([e])=>(K(e),U(Math.ceil(e.value))))),"Math:clz32":B((([e])=>(K(e),U(Math.clz32(e.value))))),"Math:cos":B((([e])=>(K(e),U(Math.cos(e.value))))),"Math:cosh":B((([e])=>(K(e),U(Math.cosh(e.value))))),"Math:exp":B((([e])=>(K(e),U(Math.exp(e.value))))),"Math:expm1":B((([e])=>(K(e),U(Math.expm1(e.value))))),"Math:floor":B((([e])=>(K(e),U(Math.floor(e.value))))),"Math:fround":B((([e])=>(K(e),U(Math.fround(e.value))))),"Math:hypot":B((([e])=>{X(e);const t=[];for(const r of e.value)K(r),t.push(r.value);return U(Math.hypot(...t))})),"Math:imul":B((([e,t])=>(K(e),K(t),U(Math.imul(e.value,t.value))))),"Math:log":B((([e])=>(K(e),U(Math.log(e.value))))),"Math:log1p":B((([e])=>(K(e),U(Math.log1p(e.value))))),"Math:log10":B((([e])=>(K(e),U(Math.log10(e.value))))),"Math:log2":B((([e])=>(K(e),U(Math.log2(e.value))))),"Math:max":B((([e,t])=>(K(e),K(t),U(Math.max(e.value,t.value))))),"Math:min":B((([e,t])=>(K(e),K(t),U(Math.min(e.value,t.value))))),"Math:pow":B((([e,t])=>(K(e),K(t),U(Math.pow(e.value,t.value))))),"Math:round":B((([e])=>(K(e),U(Math.round(e.value))))),"Math:sign":B((([e])=>(K(e),U(Math.sign(e.value))))),"Math:sin":B((([e])=>(K(e),U(Math.sin(e.value))))),"Math:sinh":B((([e])=>(K(e),U(Math.sinh(e.value))))),"Math:sqrt":B((([e])=>{K(e);const t=Math.sqrt(e.value);if(isNaN(t))throw new $("Invalid operation.");return U(t)})),"Math:tan":B((([e])=>(K(e),U(Math.tan(e.value))))),"Math:tanh":B((([e])=>(K(e),U(Math.tanh(e.value))))),"Math:trunc":B((([e])=>(K(e),U(Math.trunc(e.value))))),"Math:rnd":B((([e,t])=>e&&"num"===e.type&&t&&"num"===t.type?U(Math.floor(Math.random()*(Math.floor(t.value)-Math.ceil(e.value)+1)+Math.ceil(e.value))):U(Math.random()))),"Math:gen_rng":B((([e])=>{if(G(e),"num"!==e.type&&"str"!==e.type)return I;const t=c(e.value.toString());return B((([e,r])=>e&&"num"===e.type&&r&&"num"===r.type?U(Math.floor(t()*(Math.floor(r.value)-Math.ceil(e.value)+1)+Math.ceil(e.value))):U(t())))})),"Num:to_hex":B((([e])=>(K(e),R(e.value.toString(16))))),"Num:from_hex":B((([e])=>(Y(e),U(parseInt(e.value,16))))),"Str:lf":R("\n"),"Str:lt":B((([e,t])=>(Y(e),Y(t),e.value<t.value?U(-1):e.value===t.value?U(0):U(1)))),"Str:gt":B((([e,t])=>(Y(e),Y(t),e.value>t.value?U(-1):e.value===t.value?U(0):U(1)))),"Obj:keys":B((([e])=>(W(e),Z(Array.from(e.value.keys()).map((e=>R(e))))))),"Obj:vals":B((([e])=>(W(e),Z(Array.from(e.value.values()))))),"Obj:kvs":B((([e])=>(W(e),Z(Array.from(e.value.entries()).map((([e,t])=>Z([R(e),t]))))))),"Obj:get":B((([e,t])=>{var r;return W(e),Y(t),null!=(r=e.value.get(t.value))?r:I})),"Obj:set":B((([e,t,r])=>(W(e),Y(t),G(r),e.value.set(t.value,r),I))),"Obj:has":B((([e,t])=>(W(e),Y(t),L(e.value.has(t.value))))),"Obj:copy":B((([e])=>(W(e),J(new Map(e.value))))),"Async:interval":B((async([e,t,r],n)=>{K(e),V(t),r&&(Q(r),r.value&&n.call(t,[]));const s=setInterval((()=>{n.call(t,[])}),e.value),a=()=>{clearInterval(s)};return n.registerAbortHandler(a),B((([],e)=>{clearInterval(s),e.unregisterAbortHandler(a)}))})),"Async:timeout":B((async([e,t],r)=>{K(e),V(t);const n=setTimeout((()=>{r.call(t,[])}),e.value),s=()=>{clearTimeout(n)};return r.registerAbortHandler(s),B((([],e)=>{clearTimeout(n),e.unregisterAbortHandler(s)}))}))},oe={num:{to_str:e=>B((async(t,r)=>R(e.value.toString())))},str:{to_num:e=>B((async(t,r)=>{const n=parseInt(e.value,10);return isNaN(n)?I:U(n)})),len:e=>U(f(e.value)),replace:e=>B((async([t,r],n)=>(Y(t),Y(r),R(e.value.split(t.value).join(r.value))))),index_of:e=>B((async([t],r)=>(Y(t),U(h(e.value,t.value))))),incl:e=>B((async([t],r)=>(Y(t),e.value.includes(t.value)?q:z))),trim:e=>B((async(t,r)=>R(e.value.trim()))),upper:e=>B((async(t,r)=>R(e.value.toUpperCase()))),lower:e=>B((async(t,r)=>R(e.value.toLowerCase()))),split:e=>B((async([t],r)=>(t&&Y(t),Z(t?e.value.split(t?t.value:"").map((e=>R(e))):p(e.value).map((e=>R(e))))))),slice:e=>B((async([t,r],n)=>(K(t),K(r),R(v(e.value,t.value,r.value))))),pick:e=>B((async([t],r)=>{K(t);const n=p(e.value)[t.value];return n?R(n):I}))},arr:{len:e=>U(e.value.length),push:e=>B((async([t],r)=>(G(t),e.value.push(t),e))),unshift:e=>B((async([t],r)=>(G(t),e.value.unshift(t),e))),pop:e=>B((async(t,r)=>{var n;return null!=(n=e.value.pop())?n:I})),shift:e=>B((async(t,r)=>{var n;return null!=(n=e.value.shift())?n:I})),concat:e=>B((async([t],r)=>(X(t),Z(e.value.concat(t.value))))),slice:e=>B((async([t,r],n)=>(K(t),K(r),Z(e.value.slice(t.value,r.value))))),join:e=>B((async([t],r)=>(t&&Y(t),R(e.value.map((e=>"str"===e.type?e.value:"")).join(t?t.value:""))))),map:e=>B((async([t],r)=>{V(t);const n=e.value.map((async(e,n)=>await r.call(t,[e,U(n)])));return Z(await Promise.all(n))})),filter:e=>B((async([t],r)=>{V(t);const n=[];for(let s=0;s<e.value.length;s++){const a=e.value[s],o=await r.call(t,[a,U(s)]);Q(o),o.value&&n.push(a)}return Z(n)})),reduce:e=>B((async([t,r],n)=>{V(t);const s=null!=r;let a=s?r:e.value[0];for(let o=s?0:1;o<e.value.length;o++){const r=e.value[o];a=await n.call(t,[a,r,U(o)])}return a})),find:e=>B((async([t],r)=>{V(t);for(let n=0;n<e.value.length;n++){const s=e.value[n],a=await r.call(t,[s,U(n)]);if(Q(a),a.value)return s}return I})),incl:e=>B((async([t],r)=>{if(G(t),"str"!==t.type&&"num"!==t.type&&"bool"!==t.type&&"null"!==t.type)return z;return(n=e,n.value.map((e=>"str"===e.type||"num"===e.type||"bool"===e.type?e.value:"null"===e.type?null:Symbol()))).includes("null"===t.type?null:t.value)?q:z;var n})),reverse:e=>B((async(t,r)=>(e.value.reverse(),I))),copy:e=>B((async(t,r)=>Z([...e.value]))),sort:e=>B((async([t],r)=>{const n=async(e,t)=>{if(e.length<=1)return e;const r=Math.floor(e.length/2),a=await n(e.slice(0,r),t),o=await n(e.slice(r),t);return s(a,o,t)},s=async(e,t,n)=>{const s=[];let a=0,o=0;for(;a<e.length&&o<t.length;){const u=e[a],l=t[o],i=await r.call(n,[u,l]);K(i),i.value<0?(s.push(e[a]),a++):(s.push(t[o]),o++)}return s.concat(e.slice(a)).concat(t.slice(o))};return V(t),X(e),e.value=await n(e.value,t),e}))}};var ue=Object.defineProperty,le=Object.getOwnPropertyDescriptor,ie=(e,t,r,n)=>{for(var s,a=n>1?void 0:n?le(t,r):t,o=e.length-1;o>=0;o--)(s=e[o])&&(a=(n?s(t,r,a):s(a))||a);return n&&a&&ue(t,r,a),a};class ce{constructor(e,t){this.stepCount=0,this.stop=!1,this.abortHandlers=[],this.opts=null!=t?t:{};const r={print:B((([e])=>{G(e),this.opts.out&&this.opts.out(e)})),readline:B((async e=>{const t=e[0];if(Y(t),null==this.opts.in)return I;const r=await this.opts.in(t.value);return R(r)}))};this.vars=u(u(u({},e),ae),r),this.scope=new H([new Map(Object.entries(this.vars))]),this.scope.opts.log=(e,t)=>{switch(e){case"add":this.log("var:add",t);break;case"read":this.log("var:read",t);break;case"write":this.log("var:write",t)}}}async exec(e){if(null==e||0===e.length)return;await this.collectNs(e);const t=await this._run(e,this.scope);this.log("end",{val:t})}async execFn(e,t){return this._fn(e,t)}static collectMetadata(e){if(null==e||0===e.length)return;function t(e){switch(e.type){case"arr":return e.value.map((e=>t(e)));case"bool":return e.value;case"null":return null;case"num":return e.value;case"obj":{const r={};for(const[n,s]of e.value.entries())r[n]=t(s);return r}case"str":return e.value;default:return}}const r=new Map;for(const n of e)switch(n.type){case"meta":r.set(n.name,t(n.value))}return r}log(e,t){this.opts.log&&this.opts.log(e,t)}async collectNs(e){for(const t of e)switch(t.type){case"ns":await this.collectNsMember(t)}}async collectNsMember(e){const t=this.scope.createChildScope();for(const r of e.members)switch(r.type){case"def":{const n=await this._eval(r.expr,t);t.add(r.name,n),this.scope.add(e.name+":"+r.name,n);break}case"ns":break;default:throw new Error("invalid ns member type: "+r.type)}}async _fn(e,t){var r,n;if(e.native){const r=e.native(t,{call:this._fn,registerAbortHandler:this.registerAbortHandler,unregisterAbortHandler:this.unregisterAbortHandler});return null!=r?r:I}{const s=new Map;for(let n=0;n<(null!=(r=e.args)?r:[]).length;n++)s.set(e.args[n],t[n]);const a=e.scope.createChildScope(s);return"return"===(n=await this._run(e.statements,a)).type?n.value:n}}async _eval(e,t){if(this.stop)return I;if(this.stepCount%300==299&&await new Promise((e=>setTimeout(e,5))),this.stepCount++,this.opts.maxStep&&this.stepCount>this.opts.maxStep)throw new $("max step exceeded");switch(e.type){case"call":{const r=await this._eval(e.target,t);V(r);const n=await Promise.all(e.args.map((e=>this._eval(e,t))));return this._fn(r,n)}case"if":{const r=await this._eval(e.cond,t);if(Q(r),r.value)return this._eval(e.then,t);if(e.elseif&&e.elseif.length>0){for(const r of e.elseif){const e=await this._eval(r.cond,t);if(Q(e),e.value)return this._eval(r.then,t)}if(e.else)return this._eval(e.else,t)}else if(e.else)return this._eval(e.else,t);return I}case"match":{const r=await this._eval(e.about,t);for(const n of e.qs){if(ee(r,await this._eval(n.q,t)))return await this._eval(n.a,t)}return e.default?await this._eval(e.default,t):I}case"loop":for(;;){const r=await this._run(e.statements,t.createChildScope());if("break"===r.type)break;if("return"===r.type)return r}return I;case"for":if(e.times){const r=await this._eval(e.times,t);K(r);for(let n=0;n<r.value;n++){const r=await this._eval(e.for,t);if("break"===r.type)break;if("return"===r.type)return r}}else{const r=await this._eval(e.from,t),n=await this._eval(e.to,t);K(r),K(n);for(let s=r.value;s<r.value+n.value;s++){const r=await this._eval(e.for,t.createChildScope(new Map([[e.var,U(s)]])));if("break"===r.type)break;if("return"===r.type)return r}}return I;case"each":{const r=await this._eval(e.items,t);X(r);for(const n of r.value){const r=await this._eval(e.for,t.createChildScope(new Map([[e.var,n]])));if("break"===r.type)break;if("return"===r.type)return r}return I}case"def":{const r=await this._eval(e.expr,t);if(e.attr.length>0){const n=[];for(const r of e.attr)n.push({name:r.name,value:await this._eval(r.value,t)});r.attr=n}return t.add(e.name,r),I}case"identifier":return t.get(e.name);case"assign":{const r=await this._eval(e.expr,t);return await this.assign(t,e.dest,r),I}case"addAssign":{const r=await this._eval(e.dest,t);K(r);const n=await this._eval(e.expr,t);return K(n),await this.assign(t,e.dest,U(r.value+n.value)),I}case"subAssign":{const r=await this._eval(e.dest,t);K(r);const n=await this._eval(e.expr,t);return K(n),await this.assign(t,e.dest,U(r.value-n.value)),I}case"null":return I;case"bool":return L(e.value);case"num":return U(e.value);case"str":return R(e.value);case"arr":return Z(await Promise.all(e.value.map((async e=>await this._eval(e,t)))));case"obj":{const r=new Map;for(const n of e.value.keys())r.set(n,await this._eval(e.value.get(n),t));return J(r)}case"prop":{const r=await this._eval(e.target,t);if("obj"===r.type)return r.value.has(e.name)?r.value.get(e.name):I;if(function(e){return"num"===e.type}(r)){if(Object.hasOwn(oe.num,e.name))return oe.num[e.name](r);throw new $(`No such prop (${e.name}) in ${r.type}.`)}if(function(e){return"str"===e.type}(r)){if(Object.hasOwn(oe.str,e.name))return oe.str[e.name](r);throw new $(`No such prop (${e.name}) in ${r.type}.`)}if(function(e){return"arr"===e.type}(r)){if(Object.hasOwn(oe.arr,e.name))return oe.arr[e.name](r);throw new $(`No such prop (${e.name}) in ${r.type}.`)}throw new $(`Cannot read prop (${e.name}) of ${r.type}.`)}case"index":{const r=await this._eval(e.target,t);X(r);const n=await this._eval(e.index,t);K(n);const s=r.value[n.value];if(void 0===s)throw new E(`Index out of range. index: ${n.value} max: ${r.value.length-1}`);return s}case"not":{const r=await this._eval(e.expr,t);return Q(r),L(!r.value)}case"fn":return((e,t,r)=>({type:"fn",args:e,statements:t,scope:r}))(e.args.map((e=>e.name)),e.children,t);case"block":return this._run(e.statements,t.createChildScope());case"tmpl":{let r="";for(const n of e.tmpl)if("string"==typeof n)r+=n;else{r+=se(await this._eval(n,t))}return R(r)}case"return":{const r=await this._eval(e.expr,t);return this.log("block:return",{scope:t.name,val:r}),{type:"return",value:r}}case"break":return this.log("block:break",{scope:t.name}),{type:"break",value:null};case"continue":return this.log("block:continue",{scope:t.name}),{type:"continue",value:null};case"ns":case"meta":return I;case"and":{const r=await this._eval(e.left,t);if(Q(r),r.value){const r=await this._eval(e.right,t);return Q(r),r}return r}case"or":{const r=await this._eval(e.left,t);if(Q(r),r.value)return r;{const r=await this._eval(e.right,t);return Q(r),r}}default:throw new Error("invalid node type")}}async _run(e,t){this.log("block:enter",{scope:t.name});let r=I;for(let n=0;n<e.length;n++){const s=e[n];if(r=await this._eval(s,t),"return"===r.type)return this.log("block:return",{scope:t.name,val:r.value}),r;if("break"===r.type)return this.log("block:break",{scope:t.name}),r;if("continue"===r.type)return this.log("block:continue",{scope:t.name}),r}return this.log("block:leave",{scope:t.name,val:r}),r}registerAbortHandler(e){this.abortHandlers.push(e)}unregisterAbortHandler(e){this.abortHandlers=this.abortHandlers.filter((t=>t!==e))}abort(){this.stop=!0;for(const e of this.abortHandlers)e();this.abortHandlers=[]}async assign(e,t,r){if("identifier"===t.type)e.assign(t.name,r);else if("index"===t.type){const n=await this._eval(t.target,e);X(n);const s=await this._eval(t.index,e);K(s),n.value[s.value]=r}else{if("prop"!==t.type)throw new $("The left-hand side of an assignment expression must be a variable or a property/index access.");{const n=await this._eval(t.target,e);W(n),n.value.set(t.name,r)}}}}function fe(e,t,r,n){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,fe.prototype),s.expected=t,s.found=r,s.location=n,s.name="SyntaxError",s}function he(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function pe(e,n){var s,a,o,l,i={},c=(n=void 0!==n?n:{}).grammarSource,f={Preprocess:Xt,Main:function(){var e,t,r,n,s,a=76*zt+3,o=Bt[a];if(o)return zt=o.nextPos,o.result;e=zt,t=[],r=Fr();for(;r!==i;)t.push(r),r=Fr();(r=tr())===i&&(r=null);n=[],s=Fr();for(;s!==i;)n.push(s),s=Fr();return Ut=e,e=St(r),Bt[a]={nextPos:zt,result:e},e}},h=Xt,p="//",v="/*",d="*/",y="(",g=")",m="{",x="}",b="###",w="let",A=":",P="=",C="<:",M="#[",k="]",_="each",j=",",S="for",O="return",$="loop",E="break",T="continue",N="+=",D="-=",F="[",H=".",I="if",q="elif",z="else",U="match",R="=>",L="eval",J="`",Z='"',B="'",G="true",Q="false",V="null",Y=";",K="@(",W=/^[A-Z0-9_:]/i,X=/^[^`{]/,ee=/^[{}`]/,te=/^[+\-]/,re=/^[1-9]/,ne=/^[0-9]/,se=/^[A-Z_]/i,ae=/^[A-Z0-9_]/i,oe=/^[\r\n]/,ue=/^[ \t\r\n]/,le=/^[ \t]/,ie={type:"any"},ce=Qt("//",!1),he=Qt("/*",!1),pe=Qt("*/",!1),ve=Qt("(",!1),de=Qt(")",!1),ye=Qt("::",!1),ge=Qt("{",!1),me=Qt("}",!1),xe=Qt("###",!1),be=Qt("let",!1),we=Qt(":",!1),Ae=Qt("=",!1),Pe=Qt("var",!1),Ce=Qt("<:",!1),Me=Qt("#[",!1),ke=Qt("]",!1),_e=Qt("each",!1),je=Qt(",",!1),Se=Qt("for",!1),Oe=Qt("return",!1),$e=Vt([["A","Z"],["0","9"],"_",":"],!1,!0),Ee=Qt("loop",!1),Te=Qt("break",!1),Ne=Qt("continue",!1),De=Qt("+=",!1),Fe=Qt("-=",!1),He=Qt("\\",!1),Ie=Qt("||",!1),qe=Qt("&&",!1),ze=Qt("==",!1),Ue=Qt("!=",!1),Re=Qt("<=",!1),Le=Qt(">=",!1),Je=Qt("<",!1),Ze=Qt(">",!1),Be=Qt("+",!1),Ge=Qt("-",!1),Qe=Qt("*",!1),Ve=Qt("^",!1),Ye=Qt("/",!1),Ke=Qt("%",!1),We=Qt("!",!1),Xe=Qt("[",!1),et=Qt(".",!1),tt=Qt("if",!1),rt=Qt("elif",!1),nt=Qt("else",!1),st=Qt("match",!1),at=Qt("=>",!1),ot=Qt("eval",!1),ut=Qt("`",!1),lt=Vt(["`","{"],!0,!1),it=Vt(["{","}","`"],!1,!1),ct=Qt('"',!1),ft=Qt("'",!1),ht=Qt('\\"',!1),pt=Qt("\\'",!1),vt=Vt(["+","-"],!1,!1),dt=Vt([["1","9"]],!1,!1),yt=Vt([["0","9"]],!1,!1),gt=Qt("true",!1),mt=Qt("false",!1),xt=Qt("null",!1),bt=Qt(";",!1),wt=Qt("@",!1),At=Qt("@(",!1),Pt=Vt([["A","Z"],"_"],!1,!0),Ct=Vt([["A","Z"],["0","9"],"_"],!1,!0),Mt=Qt("\r\n",!1),kt=Vt(["\r","\n"],!1,!1),_t=Vt([" ","\t","\r","\n"],!1,!1),jt=Vt([" ","\t"],!1,!1),St=function(e){return null!=e?e:[]},Ot=function(e,t){return t},$t=function(e,t){return t},Et=function(e,t){return t},Tt=function(e,t,r){return{op:t,term:r}},Nt=function(e,n){return s=u({},e),t(s,r({chain:n}));var s},Dt=function(e,t){return t},Ft=function(e,t,r){return{q:t,a:r}},Ht=function(e,t){return{k:e,v:t}},It=function(e,t,r,n,s,a){return(e.length>0||r.length>0)&&function(e,t){throw t=void 0!==t?t:Kt(Ut,zt),function(e,t){return new fe(e,null,null,t)}(e,t)}("Cannot use spaces before or after the function name."),Ir("def",{name:t,expr:Ir("fn",{args:null!=n?n:[],retType:s},null!=a?a:[]),mut:!1,attr:[]})},qt=function(e,t){return{k:e,v:t}},zt=0,Ut=0,Rt=[{line:1,column:1}],Lt=0,Jt=[],Zt=0,Bt={};if("startRule"in n){if(!(n.startRule in f))throw new Error("Can't start parsing from rule \""+n.startRule+'".');h=f[n.startRule]}function Gt(){return e.substring(Ut,zt)}function Qt(e,t){return{type:"literal",text:e,ignoreCase:t}}function Vt(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Yt(t){var r,n=Rt[t];if(n)return n;for(r=t-1;!Rt[r];)r--;for(n={line:(n=Rt[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Rt[t]=n,n}function Kt(e,t,r){var n=Yt(e),s=Yt(t),a={source:c,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:s.line,column:s.column}};return r&&c&&"function"==typeof c.offset&&(a.start=c.offset(a.start),a.end=c.offset(a.end)),a}function Wt(e){zt<Lt||(zt>Lt&&(Lt=zt,Jt=[]),Jt.push(e))}function Xt(){var e,t,r,n=76*zt+0,s=Bt[n];if(s)return zt=s.nextPos,s.result;for(e=zt,t=[],r=er();r!==i;)t.push(r),r=er();return Ut=e,e=t=t.join(""),Bt[n]={nextPos:zt,result:e},e}function er(){var t,r,n=76*zt+1,s=Bt[n];return s?(zt=s.nextPos,s.result):(t=zt,(r=mr())!==i&&(Ut=t,r=Gt()),(t=r)===i&&(t=zt,(r=wr())!==i&&(Ut=t,r=Gt()),(t=r)===i&&(t=function(){var t,r,n,s,a,o,u=76*zt+2,l=Bt[u];if(l)return zt=l.nextPos,l.result;t=zt,e.substr(zt,2)===p?(r=p,zt+=2):(r=i,0===Zt&&Wt(ce));if(r!==i){for(n=[],s=zt,a=zt,Zt++,o=Dr(),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie)),o!==i?s=a=[a,o]:(zt=s,s=i)):(zt=s,s=i);s!==i;)n.push(s),s=zt,a=zt,Zt++,o=Dr(),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie)),o!==i?s=a=[a,o]:(zt=s,s=i)):(zt=s,s=i);Ut=t,t=""}else zt=t,t=i;if(t===i)if(t=zt,e.substr(zt,2)===v?(r=v,zt+=2):(r=i,0===Zt&&Wt(he)),r!==i){for(n=[],s=zt,a=zt,Zt++,e.substr(zt,2)===d?(o=d,zt+=2):(o=i,0===Zt&&Wt(pe)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie)),o!==i?s=a=[a,o]:(zt=s,s=i)):(zt=s,s=i);s!==i;)n.push(s),s=zt,a=zt,Zt++,e.substr(zt,2)===d?(o=d,zt+=2):(o=i,0===Zt&&Wt(pe)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie)),o!==i?s=a=[a,o]:(zt=s,s=i)):(zt=s,s=i);e.substr(zt,2)===d?(s=d,zt+=2):(s=i,0===Zt&&Wt(pe)),s!==i?(Ut=t,t=""):(zt=t,t=i)}else zt=t,t=i;return Bt[u]={nextPos:zt,result:t},t}())===i&&(e.length>zt?(t=e.charAt(zt),zt++):(t=i,0===Zt&&Wt(ie)))),Bt[n]={nextPos:zt,result:t},t)}function tr(){var e,t,r,n,s,a,o,u,l,c=76*zt+4,f=Bt[c];if(f)return zt=f.nextPos,f.result;if(e=zt,(t=nr())!==i){for(r=[],n=zt,s=[],a=Hr();a!==i;)s.push(a),a=Hr();if((a=Nr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=nr())!==i?(Ut=n,n=Ot(0,u)):(zt=n,n=i)}else zt=n,n=i;for(;n!==i;){for(r.push(n),n=zt,s=[],a=Hr();a!==i;)s.push(a),a=Hr();if((a=Nr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=nr())!==i?(Ut=n,n=Ot(0,u)):(zt=n,n=i)}else zt=n,n=i}Ut=e,l=r,e=[t,...l]}else zt=e,e=i;return Bt[c]={nextPos:zt,result:e},e}function rr(){var e,t,r,n,s,a,o,u,l,c=76*zt+6,f=Bt[c];if(f)return zt=f.nextPos,f.result;if(e=zt,(t=ar())!==i){for(r=[],n=zt,s=[],a=Hr();a!==i;)s.push(a),a=Hr();if((a=Nr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=ar())!==i?(Ut=n,n=Et(0,u)):(zt=n,n=i)}else zt=n,n=i;for(;n!==i;){for(r.push(n),n=zt,s=[],a=Hr();a!==i;)s.push(a),a=Hr();if((a=Nr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=ar())!==i?(Ut=n,n=Et(0,u)):(zt=n,n=i)}else zt=n,n=i}Ut=e,l=r,e=[t,...l]}else zt=e,e=i;return Bt[c]={nextPos:zt,result:e},e}function nr(){var t,r=76*zt+7,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=cr())===i&&(t=function(){var t,r,n,s,a,o,u=76*zt+15,l=Bt[u];if(l)return zt=l.nextPos,l.result;t=zt,e.substr(zt,3)===b?(r=b,zt+=3):(r=i,0===Zt&&Wt(xe));if(r!==i){for(n=[],s=Hr();s!==i;)n.push(s),s=Hr();if((s=$r())!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();(o=ir())!==i?(Ut=t,t=Ir("meta",{name:s,value:o})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;if(t===i)if(t=zt,e.substr(zt,3)===b?(r=b,zt+=3):(r=i,0===Zt&&Wt(xe)),r!==i){for(n=[],s=Hr();s!==i;)n.push(s),s=Hr();(s=ir())!==i?(Ut=t,t=function(e){return Ir("meta",{name:null,value:e})}(s)):(zt=t,t=i)}else zt=t,t=i;return Bt[u]={nextPos:zt,result:t},t}())===i&&(t=ar()),Bt[r]={nextPos:zt,result:t},t)}function sr(){var e,t=76*zt+8,r=Bt[t];return r?(zt=r.nextPos,r.result):((e=fr())===i&&(e=Sr())===i&&(e=cr()),Bt[t]={nextPos:zt,result:e},e)}function ar(){var t,r=76*zt+9,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=fr())===i&&(t=Sr())===i&&(t=function(){var t,r,n,s,a=76*zt+17,o=Bt[a];if(o)return zt=o.nextPos,o.result;t=zt,e.substr(zt,2)===C?(r=C,zt+=2):(r=i,0===Zt&&Wt(Ce));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();(s=or())!==i?(Ut=t,t=Ir("identifier",{name:"print",chain:[Ir("callChain",{args:[s]})]})):(zt=t,t=i)}else zt=t,t=i;return Bt[a]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o=76*zt+21,u=Bt[o];if(u)return zt=u.nextPos,u.result;t=zt,e.substr(zt,6)===O?(r=O,zt+=6):(r=i,0===Zt&&Wt(Oe));if(r!==i)if(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();(a=or())!==i?(Ut=t,t=Ir("return",{expr:a})):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i;return Bt[o]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l=76*zt+18,c=Bt[l];if(c)return zt=c.nextPos,c.result;t=zt,e.substr(zt,2)===M?(r=M,zt+=2):(r=i,0===Zt&&Wt(Me));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if((s=$r())!==i){for(a=zt,o=[],u=Fr();u!==i;)o.push(u),u=Fr();for((u=ir())!==i?a=u:(zt=a,a=i),a===i&&(a=null),o=[],u=Fr();u!==i;)o.push(u),u=Fr();93===e.charCodeAt(zt)?(u=k,zt++):(u=i,0===Zt&&Wt(ke)),u!==i?(Ut=t,t=Ir("attr",{name:s,value:null!=(f=a)?f:Ir("bool",{value:!0})})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;var f;return Bt[l]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c,f,h,p,v,d,m=76*zt+19,x=Bt[m];if(x)return zt=x.nextPos,x.result;t=zt,e.substr(zt,4)===_?(r=_,zt+=4):(r=i,0===Zt&&Wt(_e));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(40===e.charCodeAt(zt)?(s=y,zt++):(s=i,0===Zt&&Wt(ve)),s!==i)if(e.substr(zt,3)===w?(a=w,zt+=3):(a=i,0===Zt&&Wt(be)),a!==i){if(o=[],(u=Fr())!==i)for(;u!==i;)o.push(u),u=Fr();else o=i;if(o!==i)if((u=$r())!==i){for(l=[],c=Fr();c!==i;)l.push(c),c=Fr();for(44===e.charCodeAt(zt)?(c=j,zt++):(c=i,0===Zt&&Wt(je)),c===i&&(c=null),f=[],h=Fr();h!==i;)f.push(h),h=Fr();if((h=or())!==i)if(41===e.charCodeAt(zt)?(p=g,zt++):(p=i,0===Zt&&Wt(de)),p!==i){for(v=[],d=Fr();d!==i;)v.push(d),d=Fr();(d=Tr())!==i?(Ut=t,t=Ir("each",{var:u,items:h,for:d})):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;if(t===i)if(t=zt,e.substr(zt,4)===_?(r=_,zt+=4):(r=i,0===Zt&&Wt(_e)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if(e.substr(zt,3)===w?(s=w,zt+=3):(s=i,0===Zt&&Wt(be)),s!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;if(a!==i)if((o=$r())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(zt)?(l=j,zt++):(l=i,0===Zt&&Wt(je)),l===i&&(l=null),c=[],f=Fr();f!==i;)c.push(f),f=Fr();if((f=or())!==i){if(h=[],(p=Fr())!==i)for(;p!==i;)h.push(p),p=Fr();else h=i;h!==i&&(p=Tr())!==i?(Ut=t,t=function(e,t,r){return Ir("each",{var:e,items:t,for:r})}(o,f,p)):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;return Bt[m]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c,f,h,p,v,d,m,x=76*zt+20,b=Bt[x];if(b)return zt=b.nextPos,b.result;t=zt,e.substr(zt,3)===S?(r=S,zt+=3):(r=i,0===Zt&&Wt(Se));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(40===e.charCodeAt(zt)?(s=y,zt++):(s=i,0===Zt&&Wt(ve)),s!==i)if(e.substr(zt,3)===w?(a=w,zt+=3):(a=i,0===Zt&&Wt(be)),a!==i){if(o=[],(u=Fr())!==i)for(;u!==i;)o.push(u),u=Fr();else o=i;if(o!==i)if((u=$r())!==i){for(l=[],c=Fr();c!==i;)l.push(c),c=Fr();if(c=zt,61===e.charCodeAt(zt)?(f=P,zt++):(f=i,0===Zt&&Wt(Ae)),f!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();(p=or())!==i?(Ut=c,c=p):(zt=c,c=i)}else zt=c,c=i;for(c===i&&(c=null),44===e.charCodeAt(zt)?(f=j,zt++):(f=i,0===Zt&&Wt(je)),f===i&&(f=null),h=[],p=Fr();p!==i;)h.push(p),p=Fr();if((p=or())!==i)if(41===e.charCodeAt(zt)?(v=g,zt++):(v=i,0===Zt&&Wt(de)),v!==i){for(d=[],m=Fr();m!==i;)d.push(m),m=Fr();(m=Tr())!==i?(Ut=t,C=p,M=m,t=Ir("for",{var:u,from:null!=(A=c)?A:Ir("num",{value:0}),to:C,for:M})):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;var A,C,M;if(t===i){if(t=zt,e.substr(zt,3)===S?(r=S,zt+=3):(r=i,0===Zt&&Wt(Se)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if(e.substr(zt,3)===w?(s=w,zt+=3):(s=i,0===Zt&&Wt(be)),s!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;if(a!==i)if((o=$r())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(l=zt,61===e.charCodeAt(zt)?(c=P,zt++):(c=i,0===Zt&&Wt(Ae)),c!==i){for(f=[],h=Fr();h!==i;)f.push(h),h=Fr();(h=or())!==i?(Ut=l,l=function(e,t){return t}(0,h)):(zt=l,l=i)}else zt=l,l=i;for(l===i&&(l=null),44===e.charCodeAt(zt)?(c=j,zt++):(c=i,0===Zt&&Wt(je)),c===i&&(c=null),f=[],h=Fr();h!==i;)f.push(h),h=Fr();if((h=or())!==i){if(p=[],(v=Fr())!==i)for(;v!==i;)p.push(v),v=Fr();else p=i;p!==i&&(v=Tr())!==i?(Ut=t,t=function(e,t,r,n){return Ir("for",{var:e,from:null!=t?t:Ir("num",{value:0}),to:r,for:n})}(o,l,h,v)):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;if(t===i){if(t=zt,e.substr(zt,3)===S?(r=S,zt+=3):(r=i,0===Zt&&Wt(Se)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(40===e.charCodeAt(zt)?(s=y,zt++):(s=i,0===Zt&&Wt(ve)),s!==i)if((a=or())!==i)if(41===e.charCodeAt(zt)?(o=g,zt++):(o=i,0===Zt&&Wt(de)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();(l=Tr())!==i?(Ut=t,t=function(e,t){return Ir("for",{times:e,for:t})}(a,l)):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;if(t===i)if(t=zt,e.substr(zt,3)===S?(r=S,zt+=3):(r=i,0===Zt&&Wt(Se)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=or())!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;a!==i&&(o=Tr())!==i?(Ut=t,t=function(e,t){return Ir("for",{times:e,for:t})}(s,o)):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i}}return Bt[x]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c=76*zt+22,f=Bt[c];if(f)return zt=f.nextPos,f.result;t=zt,e.substr(zt,4)===$?(r=$,zt+=4):(r=i,0===Zt&&Wt(Ee));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(123===e.charCodeAt(zt)?(s=m,zt++):(s=i,0===Zt&&Wt(ge)),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();if((o=rr())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();125===e.charCodeAt(zt)?(l=x,zt++):(l=i,0===Zt&&Wt(me)),l!==i?(Ut=t,t=Ir("loop",{statements:o})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i;return Bt[c]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=76*zt+23,o=Bt[a];if(o)return zt=o.nextPos,o.result;t=zt,e.substr(zt,5)===E?(r=E,zt+=5):(r=i,0===Zt&&Wt(Te));r!==i?(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i?(Ut=t,t=Ir("break",{})):(zt=t,t=i)):(zt=t,t=i);return Bt[a]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=76*zt+24,o=Bt[a];if(o)return zt=o.nextPos,o.result;t=zt,e.substr(zt,8)===T?(r=T,zt+=8):(r=i,0===Zt&&Wt(Ne));r!==i?(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i?(Ut=t,t=Ir("continue",{})):(zt=t,t=i)):(zt=t,t=i);return Bt[a]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u=76*zt+25,l=Bt[u];if(l)return zt=l.nextPos,l.result;if(t=zt,(r=or())!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(e.substr(zt,2)===N?(s=N,zt+=2):(s=i,0===Zt&&Wt(De)),s===i&&(e.substr(zt,2)===D?(s=D,zt+=2):(s=i,0===Zt&&Wt(Fe)),s===i&&(61===e.charCodeAt(zt)?(s=P,zt++):(s=i,0===Zt&&Wt(Ae)))),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();(o=or())!==i?(Ut=t,t=Ir("+="===(c=s)?"addAssign":"-="===c?"subAssign":"assign",{dest:r,expr:o})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;var c;return Bt[u]={nextPos:zt,result:t},t}())===i&&(t=or()),Bt[r]={nextPos:zt,result:t},t)}function or(){var e,t=76*zt+10,r=Bt[t];return r?(zt=r.nextPos,r.result):((e=function(){var e,t,r,n,s,a,o,u,l=76*zt+26,c=Bt[l];if(c)return zt=c.nextPos,c.result;if(e=zt,(t=ur())!==i){for(r=[],n=zt,s=[],a=hr();a!==i;)s.push(a),a=hr();if((a=pr())!==i){for(o=[],u=hr();u!==i;)o.push(u),u=hr();(u=ur())!==i?(Ut=n,n=Tt(0,a,u)):(zt=n,n=i)}else zt=n,n=i;if(n!==i)for(;n!==i;){for(r.push(n),n=zt,s=[],a=hr();a!==i;)s.push(a),a=hr();if((a=pr())!==i){for(o=[],u=hr();u!==i;)o.push(u),u=hr();(u=ur())!==i?(Ut=n,n=Tt(0,a,u)):(zt=n,n=i)}else zt=n,n=i}else r=i;r!==i?(Ut=e,e=Ir("infix",{operands:[t,...(f=r).map((e=>e.term))],operators:f.map((e=>e.op))})):(zt=e,e=i)}else zt=e,e=i;var f;return Bt[l]={nextPos:zt,result:e},e}())===i&&(e=ur()),Bt[t]={nextPos:zt,result:e},e)}function ur(){var t,r=76*zt+11,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a,o,u,l,c,f,h=76*zt+35,p=Bt[h];if(p)return zt=p.nextPos,p.result;t=zt,e.substr(zt,2)===I?(r=I,zt+=2):(r=i,0===Zt&&Wt(tt));if(r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=or())!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;if(a!==i)if((o=Tr())!==i){if(u=zt,l=[],(c=Fr())!==i)for(;c!==i;)l.push(c),c=Fr();else l=i;if(l!==i&&(c=function(){var e,t,r,n,s,a,o=76*zt+36,u=Bt[o];if(u)return zt=u.nextPos,u.result;if(e=zt,(t=gr())!==i){for(r=[],n=zt,s=[],a=Fr();a!==i;)s.push(a),a=Fr();for((a=gr())!==i?n=a:(zt=n,n=i);n!==i;){for(r.push(n),n=zt,s=[],a=Fr();a!==i;)s.push(a),a=Fr();(a=gr())!==i?n=a:(zt=n,n=i)}Ut=e,l=r,e=[t,...l]}else zt=e,e=i;var l;return Bt[o]={nextPos:zt,result:e},e}())!==i?u=c:(zt=u,u=i),u===i&&(u=null),l=zt,c=[],(f=Fr())!==i)for(;f!==i;)c.push(f),f=Fr();else c=i;c!==i&&(f=function(){var t,r,n,s,a,o=76*zt+38,u=Bt[o];if(u)return zt=u.nextPos,u.result;t=zt,e.substr(zt,4)===z?(r=z,zt+=4):(r=i,0===Zt&&Wt(nt));if(r!==i)if(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();(a=Tr())!==i?(Ut=t,t=a):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i;return Bt[o]={nextPos:zt,result:t},t}())!==i?l=f:(zt=l,l=i),l===i&&(l=null),Ut=t,t=Ir("if",{cond:s,then:o,elseif:null!=(v=u)?v:[],else:l})}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;var v;return Bt[h]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c,f,h,p,v,d=76*zt+61,y=Bt[d];if(y)return zt=y.nextPos,y.result;t=zt,e.substr(zt,2)===K?(r=K,zt+=2):(r=i,0===Zt&&Wt(At));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=jr())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();if(41===e.charCodeAt(zt)?(o=g,zt++):(o=i,0===Zt&&Wt(de)),o!==i){for(u=zt,l=[],c=Fr();c!==i;)l.push(c),c=Fr();if(58===e.charCodeAt(zt)?(c=A,zt++):(c=i,0===Zt&&Wt(we)),c!==i){for(f=[],h=Fr();h!==i;)f.push(h),h=Fr();(h=Or())!==i?u=h:(zt=u,u=i)}else zt=u,u=i;for(u===i&&(u=null),l=[],c=Fr();c!==i;)l.push(c),c=Fr();if(123===e.charCodeAt(zt)?(c=m,zt++):(c=i,0===Zt&&Wt(ge)),c!==i){for(f=[],h=Fr();h!==i;)f.push(h),h=Fr();for((h=rr())===i&&(h=null),p=[],v=Fr();v!==i;)p.push(v),v=Fr();125===e.charCodeAt(zt)?(v=x,zt++):(v=i,0===Zt&&Wt(me)),v!==i?(Ut=t,t=Ir("fn",{args:null!=(b=s)?b:[],retType:u},null!=(w=h)?w:[])):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i;var b,w;return Bt[d]={nextPos:zt,result:t},t}())===i&&(t=function(){var e,t,r,n,s=76*zt+30,a=Bt[s];if(a)return zt=a.nextPos,a.result;if(e=zt,(t=lr())!==i){if(r=[],(n=vr())===i&&(n=dr())===i&&(n=yr()),n!==i)for(;n!==i;)r.push(n),(n=vr())===i&&(n=dr())===i&&(n=yr());else r=i;r!==i?(Ut=e,e=Nt(t,r)):(zt=e,e=i)}else zt=e,e=i;return Bt[s]={nextPos:zt,result:e},e}())===i&&(t=lr()),Bt[r]={nextPos:zt,result:t},t)}function lr(){var t,r,n,s,a,o,u=76*zt+12,l=Bt[u];if(l)return zt=l.nextPos,l.result;if((t=function(){var t,r,n,s,a,o,u,l,c,f,h,p,v,d,y,g,b,w=76*zt+39,A=Bt[w];if(A)return zt=A.nextPos,A.result;t=zt,e.substr(zt,5)===U?(r=U,zt+=5):(r=i,0===Zt&&Wt(st));if(r!==i)if(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();if((a=or())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(123===e.charCodeAt(zt)?(u=m,zt++):(u=i,0===Zt&&Wt(ge)),u!==i){for(l=[],c=Fr();c!==i;)l.push(c),c=Fr();if(c=[],f=zt,(h=or())!==i){for(p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(e.substr(zt,2)===R?(v=R,zt+=2):(v=i,0===Zt&&Wt(at)),v!==i){for(d=[],y=Fr();y!==i;)d.push(y),y=Fr();if((y=Tr())!==i){for(g=[],b=Fr();b!==i;)g.push(b),b=Fr();Ut=f,f=Ft(0,h,y)}else zt=f,f=i}else zt=f,f=i}else zt=f,f=i;if(f!==i)for(;f!==i;)if(c.push(f),f=zt,(h=or())!==i){for(p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(e.substr(zt,2)===R?(v=R,zt+=2):(v=i,0===Zt&&Wt(at)),v!==i){for(d=[],y=Fr();y!==i;)d.push(y),y=Fr();if((y=Tr())!==i){for(g=[],b=Fr();b!==i;)g.push(b),b=Fr();Ut=f,f=Ft(0,h,y)}else zt=f,f=i}else zt=f,f=i}else zt=f,f=i;else c=i;if(c!==i){if(f=zt,42===e.charCodeAt(zt)?(h="*",zt++):(h=i,0===Zt&&Wt(Qe)),h!==i){for(p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(e.substr(zt,2)===R?(v=R,zt+=2):(v=i,0===Zt&&Wt(at)),v!==i){for(d=[],y=Fr();y!==i;)d.push(y),y=Fr();if((y=Tr())!==i){for(g=[],b=Fr();b!==i;)g.push(b),b=Fr();f=y}else zt=f,f=i}else zt=f,f=i}else zt=f,f=i;for(f===i&&(f=null),h=[],p=Fr();p!==i;)h.push(p),p=Fr();125===e.charCodeAt(zt)?(p=x,zt++):(p=i,0===Zt&&Wt(me)),p!==i?(Ut=t,t=Ir("match",{about:a,qs:null!=(P=c)?P:[],default:f})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i;else zt=t,t=i;var P;return Bt[w]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c=76*zt+40,f=Bt[c];if(f)return zt=f.nextPos,f.result;t=zt,e.substr(zt,4)===L?(r=L,zt+=4):(r=i,0===Zt&&Wt(ot));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(123===e.charCodeAt(zt)?(s=m,zt++):(s=i,0===Zt&&Wt(ge)),s!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();if((o=rr())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();125===e.charCodeAt(zt)?(l=x,zt++):(l=i,0===Zt&&Wt(me)),l!==i?(Ut=t,t=Ir("block",{statements:o})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i;return Bt[c]={nextPos:zt,result:t},t}())===i&&(t=mr())===i&&(t=wr())===i&&(t=Cr())===i&&(t=Mr())===i&&(t=kr())===i&&(t=function(){var t,r,n,s,a,o,u,l,c,f,h,p,v,d,y=76*zt+56,g=Bt[y];if(g)return zt=g.nextPos,g.result;t=zt,123===e.charCodeAt(zt)?(r=m,zt++):(r=i,0===Zt&&Wt(ge));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=zt,(o=$r())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(zt)?(l=A,zt++):(l=i,0===Zt&&Wt(we)),l!==i){if(c=[],(f=Fr())!==i)for(;f!==i;)c.push(f),f=Fr();else c=i;if(c!==i)if((f=or())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(zt)?(p=j,zt++):(p=i,0===Zt&&Wt(je)),p===i&&(59===e.charCodeAt(zt)?(p=Y,zt++):(p=i,0===Zt&&Wt(bt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Ut=a,a=Ht(o,f)}else zt=a,a=i;else zt=a,a=i}else zt=a,a=i}else zt=a,a=i;for(;a!==i;)if(s.push(a),a=zt,(o=$r())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(zt)?(l=A,zt++):(l=i,0===Zt&&Wt(we)),l!==i){if(c=[],(f=Fr())!==i)for(;f!==i;)c.push(f),f=Fr();else c=i;if(c!==i)if((f=or())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(zt)?(p=j,zt++):(p=i,0===Zt&&Wt(je)),p===i&&(59===e.charCodeAt(zt)?(p=Y,zt++):(p=i,0===Zt&&Wt(bt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Ut=a,a=Ht(o,f)}else zt=a,a=i;else zt=a,a=i}else zt=a,a=i}else zt=a,a=i;125===e.charCodeAt(zt)?(a=x,zt++):(a=i,0===Zt&&Wt(me)),a!==i?(Ut=t,t=function(e){const t=new Map;for(const r of e)t.set(r.k,r.v);return Ir("obj",{value:t})}(s)):(zt=t,t=i)}else zt=t,t=i;return Bt[y]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c,f,h=76*zt+57,p=Bt[h];if(p)return zt=p.nextPos,p.result;t=zt,91===e.charCodeAt(zt)?(r=F,zt++):(r=i,0===Zt&&Wt(Xe));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=zt,(o=or())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(zt)?(l=j,zt++):(l=i,0===Zt&&Wt(je)),l===i&&(l=null),c=[],f=Fr();f!==i;)c.push(f),f=Fr();Ut=a,a=o}else zt=a,a=i;for(;a!==i;)if(s.push(a),a=zt,(o=or())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(zt)?(l=j,zt++):(l=i,0===Zt&&Wt(je)),l===i&&(l=null),c=[],f=Fr();f!==i;)c.push(f),f=Fr();Ut=a,a=o}else zt=a,a=i;for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();93===e.charCodeAt(zt)?(o=k,zt++):(o=i,0===Zt&&Wt(ke)),o!==i?(Ut=t,t=Ir("arr",{value:s})):(zt=t,t=i)}else zt=t,t=i;return Bt[h]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s=76*zt+29,a=Bt[s];if(a)return zt=a.nextPos,a.result;t=zt,33===e.charCodeAt(zt)?(r="!",zt++):(r=i,0===Zt&&Wt(We));r!==i&&(n=or())!==i?(Ut=t,t=Ir("not",{expr:n})):(zt=t,t=i);return Bt[s]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n=76*zt+41,s=Bt[n];if(s)return zt=s.nextPos,s.result;t=zt,(r=function(){var t,r,n,s,a,o=76*zt+69,u=Bt[o];if(u)return zt=u.nextPos,u.result;if(t=zt,$r()!==i){for(r=[],n=zt,58===e.charCodeAt(zt)?(s=A,zt++):(s=i,0===Zt&&Wt(we)),s!==i&&(a=$r())!==i?n=s=[s,a]:(zt=n,n=i);n!==i;)r.push(n),n=zt,58===e.charCodeAt(zt)?(s=A,zt++):(s=i,0===Zt&&Wt(we)),s!==i&&(a=$r())!==i?n=s=[s,a]:(zt=n,n=i);Ut=t,t=Gt()}else zt=t,t=i;return Bt[o]={nextPos:zt,result:t},t}())!==i&&(Ut=t,r=Ir("identifier",{name:r}));return t=r,Bt[n]={nextPos:zt,result:t},t}())===i)if(t=zt,40===e.charCodeAt(zt)?(r=y,zt++):(r=i,0===Zt&&Wt(ve)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if((s=or())!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();41===e.charCodeAt(zt)?(o=g,zt++):(o=i,0===Zt&&Wt(de)),o!==i?(Ut=t,t=s):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;return Bt[u]={nextPos:zt,result:t},t}function ir(){var t,r=76*zt+13,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=Cr())===i&&(t=wr())===i&&(t=Mr())===i&&(t=function(){var t,r,n,s,a,o,u,l,c,f,h=76*zt+62,p=Bt[h];if(p)return zt=p.nextPos,p.result;t=zt,91===e.charCodeAt(zt)?(r=F,zt++):(r=i,0===Zt&&Wt(Xe));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=zt,(o=ir())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(zt)?(l=j,zt++):(l=i,0===Zt&&Wt(je)),l===i&&(l=null),c=[],f=Fr();f!==i;)c.push(f),f=Fr();Ut=a,a=o}else zt=a,a=i;for(;a!==i;)if(s.push(a),a=zt,(o=ir())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for(44===e.charCodeAt(zt)?(l=j,zt++):(l=i,0===Zt&&Wt(je)),l===i&&(l=null),c=[],f=Fr();f!==i;)c.push(f),f=Fr();Ut=a,a=o}else zt=a,a=i;for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();93===e.charCodeAt(zt)?(o=k,zt++):(o=i,0===Zt&&Wt(ke)),o!==i?(Ut=t,t=Ir("arr",{value:s})):(zt=t,t=i)}else zt=t,t=i;return Bt[h]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c,f,h,p,v,d,y=76*zt+63,g=Bt[y];if(g)return zt=g.nextPos,g.result;t=zt,123===e.charCodeAt(zt)?(r=m,zt++):(r=i,0===Zt&&Wt(ge));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if(s=[],a=zt,(o=$r())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(zt)?(l=A,zt++):(l=i,0===Zt&&Wt(we)),l!==i){if(c=[],(f=Fr())!==i)for(;f!==i;)c.push(f),f=Fr();else c=i;if(c!==i)if((f=ir())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(zt)?(p=j,zt++):(p=i,0===Zt&&Wt(je)),p===i&&(59===e.charCodeAt(zt)?(p=Y,zt++):(p=i,0===Zt&&Wt(bt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Ut=a,a=qt(o,f)}else zt=a,a=i;else zt=a,a=i}else zt=a,a=i}else zt=a,a=i;for(;a!==i;)if(s.push(a),a=zt,(o=$r())!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(58===e.charCodeAt(zt)?(l=A,zt++):(l=i,0===Zt&&Wt(we)),l!==i){if(c=[],(f=Fr())!==i)for(;f!==i;)c.push(f),f=Fr();else c=i;if(c!==i)if((f=ir())!==i){for(h=[],p=Fr();p!==i;)h.push(p),p=Fr();for(44===e.charCodeAt(zt)?(p=j,zt++):(p=i,0===Zt&&Wt(je)),p===i&&(59===e.charCodeAt(zt)?(p=Y,zt++):(p=i,0===Zt&&Wt(bt))),p===i&&(p=null),v=[],d=Fr();d!==i;)v.push(d),d=Fr();Ut=a,a=qt(o,f)}else zt=a,a=i;else zt=a,a=i}else zt=a,a=i}else zt=a,a=i;125===e.charCodeAt(zt)?(a=x,zt++):(a=i,0===Zt&&Wt(me)),a!==i?(Ut=t,t=function(e){const t=new Map;for(const r of e)t.set(r.k,r.v);return Ir("obj",{value:t})}(s)):(zt=t,t=i)}else zt=t,t=i;return Bt[y]={nextPos:zt,result:t},t}())===i&&(t=kr()),Bt[r]={nextPos:zt,result:t},t)}function cr(){var t,r,n,s,a,o,u,l,c,f,h=76*zt+14,p=Bt[h];if(p)return zt=p.nextPos,p.result;if(t=zt,"::"===e.substr(zt,2)?(r="::",zt+=2):(r=i,0===Zt&&Wt(ye)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=$r())!==i){if(a=[],(o=Fr())!==i)for(;o!==i;)a.push(o),o=Fr();else a=i;if(a!==i)if(123===e.charCodeAt(zt)?(o=m,zt++):(o=i,0===Zt&&Wt(ge)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for((l=function(){var e,t,r,n,s,a,o,u,l,c=76*zt+5,f=Bt[c];if(f)return zt=f.nextPos,f.result;if(e=zt,(t=sr())!==i){for(r=[],n=zt,s=[],a=Hr();a!==i;)s.push(a),a=Hr();if((a=Nr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=sr())!==i?(Ut=n,n=$t(0,u)):(zt=n,n=i)}else zt=n,n=i;for(;n!==i;){for(r.push(n),n=zt,s=[],a=Hr();a!==i;)s.push(a),a=Hr();if((a=Nr())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=sr())!==i?(Ut=n,n=$t(0,u)):(zt=n,n=i)}else zt=n,n=i}Ut=e,l=r,e=[t,...l]}else zt=e,e=i;return Bt[c]={nextPos:zt,result:e},e}())===i&&(l=null),c=[],f=Fr();f!==i;)c.push(f),f=Fr();125===e.charCodeAt(zt)?(f=x,zt++):(f=i,0===Zt&&Wt(me)),f!==i?(Ut=t,t=Ir("ns",{name:s,members:l})):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;return Bt[h]={nextPos:zt,result:t},t}function fr(){var t,r,n,s,a,o,u,l,c,f=76*zt+16,h=Bt[f];if(h)return zt=h.nextPos,h.result;if(t=zt,e.substr(zt,3)===w?(r=w,zt+=3):(r=i,0===Zt&&Wt(be)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=$r())!==i){for(a=zt,o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(58===e.charCodeAt(zt)?(u=A,zt++):(u=i,0===Zt&&Wt(we)),u!==i){for(l=[],c=Fr();c!==i;)l.push(c),c=Fr();(c=Or())!==i?a=c:(zt=a,a=i)}else zt=a,a=i;for(a===i&&(a=null),o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(61===e.charCodeAt(zt)?(u=P,zt++):(u=i,0===Zt&&Wt(Ae)),u!==i){for(l=[],c=Fr();c!==i;)l.push(c),c=Fr();(c=or())!==i?(Ut=t,t=Ir("def",{name:s,varType:a,expr:c,mut:!1,attr:[]})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;if(t===i)if(t=zt,"var"===e.substr(zt,3)?(r="var",zt+=3):(r=i,0===Zt&&Wt(Pe)),r!==i){if(n=[],(s=Fr())!==i)for(;s!==i;)n.push(s),s=Fr();else n=i;if(n!==i)if((s=$r())!==i){for(a=zt,o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(58===e.charCodeAt(zt)?(u=A,zt++):(u=i,0===Zt&&Wt(we)),u!==i){for(l=[],c=Fr();c!==i;)l.push(c),c=Fr();(c=Or())!==i?a=c:(zt=a,a=i)}else zt=a,a=i;for(a===i&&(a=null),o=[],u=Fr();u!==i;)o.push(u),u=Fr();if(61===e.charCodeAt(zt)?(u=P,zt++):(u=i,0===Zt&&Wt(Ae)),u!==i){for(l=[],c=Fr();c!==i;)l.push(c),c=Fr();(c=or())!==i?(Ut=t,t=function(e,t,r){return Ir("def",{name:e,varType:t,expr:r,mut:!0,attr:[]})}(s,a,c)):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;return Bt[f]={nextPos:zt,result:t},t}function hr(){var t,r,n,s=76*zt+27,a=Bt[s];return a?(zt=a.nextPos,a.result):(t=zt,92===e.charCodeAt(zt)?(r="\\",zt++):(r=i,0===Zt&&Wt(He)),r!==i&&(n=Nr())!==i?t=r=[r,n]:(zt=t,t=i),t===i&&(t=Hr()),Bt[s]={nextPos:zt,result:t},t)}function pr(){var t,r,n=76*zt+28,s=Bt[n];return s?(zt=s.nextPos,s.result):(t=zt,"||"===e.substr(zt,2)?(r="||",zt+=2):(r=i,0===Zt&&Wt(Ie)),r===i&&("&&"===e.substr(zt,2)?(r="&&",zt+=2):(r=i,0===Zt&&Wt(qe)),r===i&&("=="===e.substr(zt,2)?(r="==",zt+=2):(r=i,0===Zt&&Wt(ze)),r===i&&("!="===e.substr(zt,2)?(r="!=",zt+=2):(r=i,0===Zt&&Wt(Ue)),r===i&&("<="===e.substr(zt,2)?(r="<=",zt+=2):(r=i,0===Zt&&Wt(Re)),r===i&&(">="===e.substr(zt,2)?(r=">=",zt+=2):(r=i,0===Zt&&Wt(Le)),r===i&&(60===e.charCodeAt(zt)?(r="<",zt++):(r=i,0===Zt&&Wt(Je)),r===i&&(62===e.charCodeAt(zt)?(r=">",zt++):(r=i,0===Zt&&Wt(Ze)),r===i&&(43===e.charCodeAt(zt)?(r="+",zt++):(r=i,0===Zt&&Wt(Be)),r===i&&(45===e.charCodeAt(zt)?(r="-",zt++):(r=i,0===Zt&&Wt(Ge)),r===i&&(42===e.charCodeAt(zt)?(r="*",zt++):(r=i,0===Zt&&Wt(Qe)),r===i&&(94===e.charCodeAt(zt)?(r="^",zt++):(r=i,0===Zt&&Wt(Ve)),r===i&&(47===e.charCodeAt(zt)?(r="/",zt++):(r=i,0===Zt&&Wt(Ye)),r===i&&(37===e.charCodeAt(zt)?(r="%",zt++):(r=i,0===Zt&&Wt(Ke))))))))))))))),r!==i&&(Ut=t,r=Gt()),t=r,Bt[n]={nextPos:zt,result:t},t)}function vr(){var t,r,n,s,a,o,u,l=76*zt+31,c=Bt[l];if(c)return zt=c.nextPos,c.result;if(t=zt,40===e.charCodeAt(zt)?(r=y,zt++):(r=i,0===Zt&&Wt(ve)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=function(){var e,t,r,n,s,a=76*zt+32,o=Bt[a];if(o)return zt=o.nextPos,o.result;if(e=zt,(t=or())!==i){for(r=[],n=zt,Er()!==i&&(s=or())!==i?(Ut=n,n=Dt(0,s)):(zt=n,n=i);n!==i;)r.push(n),n=zt,Er()!==i&&(s=or())!==i?(Ut=n,n=Dt(0,s)):(zt=n,n=i);Ut=e,u=r,e=[t,...u]}else zt=e,e=i;var u;return Bt[a]={nextPos:zt,result:e},e}())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();41===e.charCodeAt(zt)?(o=g,zt++):(o=i,0===Zt&&Wt(de)),o!==i?(Ut=t,t=Ir("callChain",{args:null!=(u=s)?u:[]})):(zt=t,t=i)}else zt=t,t=i;return Bt[l]={nextPos:zt,result:t},t}function dr(){var t,r,n,s,a,o,u=76*zt+33,l=Bt[u];if(l)return zt=l.nextPos,l.result;if(t=zt,91===e.charCodeAt(zt)?(r=F,zt++):(r=i,0===Zt&&Wt(Xe)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();if((s=or())!==i){for(a=[],o=Fr();o!==i;)a.push(o),o=Fr();93===e.charCodeAt(zt)?(o=k,zt++):(o=i,0===Zt&&Wt(ke)),o!==i?(Ut=t,t=Ir("indexChain",{index:s})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;return Bt[u]={nextPos:zt,result:t},t}function yr(){var t,r,n,s=76*zt+34,a=Bt[s];return a?(zt=a.nextPos,a.result):(t=zt,46===e.charCodeAt(zt)?(r=".",zt++):(r=i,0===Zt&&Wt(et)),r!==i&&(n=$r())!==i?(Ut=t,t=Ir("propChain",{name:n})):(zt=t,t=i),Bt[s]={nextPos:zt,result:t},t)}function gr(){var t,r,n,s,a,o,u,l=76*zt+37,c=Bt[l];if(c)return zt=c.nextPos,c.result;if(t=zt,e.substr(zt,4)===q?(r=q,zt+=4):(r=i,0===Zt&&Wt(rt)),r!==i)if(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();if((a=or())!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=Tr())!==i?(Ut=t,t={cond:a,then:u}):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;else zt=t,t=i;return Bt[l]={nextPos:zt,result:t},t}function mr(){var t,r,n,s,a,o,u=76*zt+42,l=Bt[u];if(l)return zt=l.nextPos,l.result;if(t=zt,96===e.charCodeAt(zt)?(r=J,zt++):(r=i,0===Zt&&Wt(ut)),r!==i){for(n=[],s=zt,a=zt,Zt++,96===e.charCodeAt(zt)?(o=J,zt++):(o=i,0===Zt&&Wt(ut)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i&&(o=xr())!==i?s=o:(zt=s,s=i);s!==i;)n.push(s),s=zt,a=zt,Zt++,96===e.charCodeAt(zt)?(o=J,zt++):(o=i,0===Zt&&Wt(ut)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i&&(o=xr())!==i?s=o:(zt=s,s=i);96===e.charCodeAt(zt)?(s=J,zt++):(s=i,0===Zt&&Wt(ut)),s!==i?(Ut=t,t=Ir("tmpl",{tmpl:n})):(zt=t,t=i)}else zt=t,t=i;return Bt[u]={nextPos:zt,result:t},t}function xr(){var t,r,n,s,a,o,u=76*zt+43,l=Bt[u];if(l)return zt=l.nextPos,l.result;if(t=zt,123===e.charCodeAt(zt)?(r=m,zt++):(r=i,0===Zt&&Wt(ge)),r!==i){for(n=[],s=Hr();s!==i;)n.push(s),s=Hr();if((s=or())!==i){for(a=[],o=Hr();o!==i;)a.push(o),o=Hr();125===e.charCodeAt(zt)?(o=x,zt++):(o=i,0===Zt&&Wt(me)),o!==i?t=s:(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i;if(t===i){if(t=zt,r=[],(n=br())!==i)for(;n!==i;)r.push(n),n=br();else r=i;r!==i&&(Ut=t,r=r.join("")),t=r}return Bt[u]={nextPos:zt,result:t},t}function br(){var t,r=76*zt+44,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=function(){var t,r,n,s=76*zt+45,a=Bt[s];if(a)return zt=a.nextPos,a.result;t=zt,92===e.charCodeAt(zt)?(r="\\",zt++):(r=i,0===Zt&&Wt(He));r!==i?(ee.test(e.charAt(zt))?(n=e.charAt(zt),zt++):(n=i,0===Zt&&Wt(it)),n!==i?t=n:(zt=t,t=i)):(zt=t,t=i);return Bt[s]={nextPos:zt,result:t},t}())===i&&(X.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=i,0===Zt&&Wt(lt))),Bt[r]={nextPos:zt,result:t},t)}function wr(){var t,r,n,s,a,o,u=76*zt+46,l=Bt[u];if(l)return zt=l.nextPos,l.result;if(t=zt,34===e.charCodeAt(zt)?(r=Z,zt++):(r=i,0===Zt&&Wt(ct)),r!==i){for(n=[],s=zt,a=zt,Zt++,34===e.charCodeAt(zt)?(o=Z,zt++):(o=i,0===Zt&&Wt(ct)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?((o=Ar())===i&&(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie))),o!==i?(Ut=s,s=o):(zt=s,s=i)):(zt=s,s=i);s!==i;)n.push(s),s=zt,a=zt,Zt++,34===e.charCodeAt(zt)?(o=Z,zt++):(o=i,0===Zt&&Wt(ct)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?((o=Ar())===i&&(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie))),o!==i?(Ut=s,s=o):(zt=s,s=i)):(zt=s,s=i);34===e.charCodeAt(zt)?(s=Z,zt++):(s=i,0===Zt&&Wt(ct)),s!==i?(Ut=t,t=Ir("str",{value:n.join("")})):(zt=t,t=i)}else zt=t,t=i;if(t===i)if(t=zt,39===e.charCodeAt(zt)?(r=B,zt++):(r=i,0===Zt&&Wt(ft)),r!==i){for(n=[],s=zt,a=zt,Zt++,39===e.charCodeAt(zt)?(o=B,zt++):(o=i,0===Zt&&Wt(ft)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?((o=Pr())===i&&(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie))),o!==i?(Ut=s,s=o):(zt=s,s=i)):(zt=s,s=i);s!==i;)n.push(s),s=zt,a=zt,Zt++,39===e.charCodeAt(zt)?(o=B,zt++):(o=i,0===Zt&&Wt(ft)),Zt--,o===i?a=void 0:(zt=a,a=i),a!==i?((o=Pr())===i&&(e.length>zt?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(ie))),o!==i?(Ut=s,s=o):(zt=s,s=i)):(zt=s,s=i);39===e.charCodeAt(zt)?(s=B,zt++):(s=i,0===Zt&&Wt(ft)),s!==i?(Ut=t,t=function(e){return Ir("str",{value:e.join("")})}(n)):(zt=t,t=i)}else zt=t,t=i;return Bt[u]={nextPos:zt,result:t},t}function Ar(){var t,r,n=76*zt+47,s=Bt[n];return s?(zt=s.nextPos,s.result):(t=zt,'\\"'===e.substr(zt,2)?(r='\\"',zt+=2):(r=i,0===Zt&&Wt(ht)),r!==i&&(Ut=t,r='"'),t=r,Bt[n]={nextPos:zt,result:t},t)}function Pr(){var t,r,n=76*zt+48,s=Bt[n];return s?(zt=s.nextPos,s.result):(t=zt,"\\'"===e.substr(zt,2)?(r="\\'",zt+=2):(r=i,0===Zt&&Wt(pt)),r!==i&&(Ut=t,r="'"),t=r,Bt[n]={nextPos:zt,result:t},t)}function Cr(){var t,r=76*zt+49,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a,o,u=76*zt+50,l=Bt[u];if(l)return zt=l.nextPos,l.result;t=zt,te.test(e.charAt(zt))?(e.charAt(zt),zt++):0===Zt&&Wt(vt);re.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=i,0===Zt&&Wt(dt));if(r!==i){if(n=[],ne.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt(yt)),s!==i)for(;s!==i;)n.push(s),ne.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt(yt));else n=i;if(n!==i)if(46===e.charCodeAt(zt)?(s=H,zt++):(s=i,0===Zt&&Wt(et)),s!==i){if(a=[],ne.test(e.charAt(zt))?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(yt)),o!==i)for(;o!==i;)a.push(o),ne.test(e.charAt(zt))?(o=e.charAt(zt),zt++):(o=i,0===Zt&&Wt(yt));else a=i;a!==i?(Ut=t,t=Ir("num",{value:parseFloat(Gt())})):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i}else zt=t,t=i;if(t===i)if(t=zt,te.test(e.charAt(zt))?(e.charAt(zt),zt++):0===Zt&&Wt(vt),ne.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=i,0===Zt&&Wt(yt)),r!==i)if(46===e.charCodeAt(zt)?(n=H,zt++):(n=i,0===Zt&&Wt(et)),n!==i){if(s=[],ne.test(e.charAt(zt))?(a=e.charAt(zt),zt++):(a=i,0===Zt&&Wt(yt)),a!==i)for(;a!==i;)s.push(a),ne.test(e.charAt(zt))?(a=e.charAt(zt),zt++):(a=i,0===Zt&&Wt(yt));else s=i;s!==i?(Ut=t,t=Ir("num",{value:parseFloat(Gt())})):(zt=t,t=i)}else zt=t,t=i;else zt=t,t=i;return Bt[u]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=76*zt+51,o=Bt[a];if(o)return zt=o.nextPos,o.result;t=zt,te.test(e.charAt(zt))?(e.charAt(zt),zt++):0===Zt&&Wt(vt);re.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=i,0===Zt&&Wt(dt));if(r!==i){if(n=[],ne.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt(yt)),s!==i)for(;s!==i;)n.push(s),ne.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt(yt));else n=i;n!==i?(Ut=t,t=Ir("num",{value:parseInt(Gt(),10)})):(zt=t,t=i)}else zt=t,t=i;t===i&&(t=zt,te.test(e.charAt(zt))?(e.charAt(zt),zt++):0===Zt&&Wt(vt),ne.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=i,0===Zt&&Wt(yt)),r!==i?(Ut=t,t=Ir("num",{value:parseInt(Gt(),10)})):(zt=t,t=i));return Bt[a]={nextPos:zt,result:t},t}()),Bt[r]={nextPos:zt,result:t},t)}function Mr(){var t,r=76*zt+52,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a=76*zt+53,o=Bt[a];if(o)return zt=o.nextPos,o.result;t=zt,e.substr(zt,4)===G?(r=G,zt+=4):(r=i,0===Zt&&Wt(gt));r!==i?(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i?(Ut=t,t=Ir("bool",{value:!0})):(zt=t,t=i)):(zt=t,t=i);return Bt[a]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a=76*zt+54,o=Bt[a];if(o)return zt=o.nextPos,o.result;t=zt,e.substr(zt,5)===Q?(r=Q,zt+=5):(r=i,0===Zt&&Wt(mt));r!==i?(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i?(Ut=t,t=Ir("bool",{value:!1})):(zt=t,t=i)):(zt=t,t=i);return Bt[a]={nextPos:zt,result:t},t}()),Bt[r]={nextPos:zt,result:t},t)}function kr(){var t,r,n,s,a=76*zt+55,o=Bt[a];return o?(zt=o.nextPos,o.result):(t=zt,e.substr(zt,4)===V?(r=V,zt+=4):(r=i,0===Zt&&Wt(xt)),r!==i?(n=zt,Zt++,W.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt($e)),Zt--,s===i?n=void 0:(zt=n,n=i),n!==i?(Ut=t,t=Ir("null",{})):(zt=t,t=i)):(zt=t,t=i),Bt[a]={nextPos:zt,result:t},t)}function _r(){var t,r,n,s,a,o,u,l=76*zt+58,c=Bt[l];if(c)return zt=c.nextPos,c.result;if(t=zt,(r=$r())!==i){for(n=zt,s=[],a=Fr();a!==i;)s.push(a),a=Fr();if(58===e.charCodeAt(zt)?(a=A,zt++):(a=i,0===Zt&&Wt(we)),a!==i){for(o=[],u=Fr();u!==i;)o.push(u),u=Fr();(u=Or())!==i?n=u:(zt=n,n=i)}else zt=n,n=i;n===i&&(n=null),Ut=t,t={name:r,argType:n}}else zt=t,t=i;return Bt[l]={nextPos:zt,result:t},t}function jr(){var e,t,r,n,s,a,o=76*zt+59,u=Bt[o];if(u)return zt=u.nextPos,u.result;if(e=zt,(t=_r())!==i){for(r=[],n=zt,Er()!==i&&(s=_r())!==i?n=s:(zt=n,n=i);n!==i;)r.push(n),n=zt,Er()!==i&&(s=_r())!==i?n=s:(zt=n,n=i);Ut=e,a=r,e=[t,...a]}else zt=e,e=i;return Bt[o]={nextPos:zt,result:e},e}function Sr(){var t,r,n,s,a,o,u,l,c,f,h,p,v,d,b,w,P,C=76*zt+60,M=Bt[C];if(M)return zt=M.nextPos,M.result;if(t=zt,64===e.charCodeAt(zt)?(r="@",zt++):(r=i,0===Zt&&Wt(wt)),r!==i){for(n=[],s=Hr();s!==i;)n.push(s),s=Hr();if((s=$r())!==i){for(a=[],o=Hr();o!==i;)a.push(o),o=Hr();if(40===e.charCodeAt(zt)?(o=y,zt++):(o=i,0===Zt&&Wt(ve)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();for((l=jr())===i&&(l=null),c=[],f=Fr();f!==i;)c.push(f),f=Fr();if(41===e.charCodeAt(zt)?(f=g,zt++):(f=i,0===Zt&&Wt(de)),f!==i){for(h=zt,p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(58===e.charCodeAt(zt)?(v=A,zt++):(v=i,0===Zt&&Wt(we)),v!==i){for(d=[],b=Fr();b!==i;)d.push(b),b=Fr();(b=Or())!==i?h=b:(zt=h,h=i)}else zt=h,h=i;for(h===i&&(h=null),p=[],v=Fr();v!==i;)p.push(v),v=Fr();if(123===e.charCodeAt(zt)?(v=m,zt++):(v=i,0===Zt&&Wt(ge)),v!==i){for(d=[],b=Fr();b!==i;)d.push(b),b=Fr();for((b=rr())===i&&(b=null),w=[],P=Fr();P!==i;)w.push(P),P=Fr();125===e.charCodeAt(zt)?(P=x,zt++):(P=i,0===Zt&&Wt(me)),P!==i?(Ut=t,t=It(n,s,a,l,h,b)):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i;return Bt[C]={nextPos:zt,result:t},t}function Or(){var t,r=76*zt+64,n=Bt[r];return n?(zt=n.nextPos,n.result):((t=function(){var t,r,n,s,a,o,u,l,c,f,h=76*zt+65,p=Bt[h];if(p)return zt=p.nextPos,p.result;t=zt,e.substr(zt,2)===K?(r=K,zt+=2):(r=i,0===Zt&&Wt(At));if(r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=function(){var e,t,r,n,s,a=76*zt+66,o=Bt[a];if(o)return zt=o.nextPos,o.result;if(e=zt,(t=Or())!==i){for(r=[],n=zt,Er()!==i&&(s=Or())!==i?n=s:(zt=n,n=i);n!==i;)r.push(n),n=zt,Er()!==i&&(s=Or())!==i?n=s:(zt=n,n=i);Ut=e,u=r,e=[t,...u]}else zt=e,e=i;var u;return Bt[a]={nextPos:zt,result:e},e}())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();if(41===e.charCodeAt(zt)?(o=g,zt++):(o=i,0===Zt&&Wt(de)),o!==i){for(u=[],l=Fr();l!==i;)u.push(l),l=Fr();if(e.substr(zt,2)===R?(l=R,zt+=2):(l=i,0===Zt&&Wt(at)),l!==i){for(c=[],f=Fr();f!==i;)c.push(f),f=Fr();(f=Or())!==i?(Ut=t,t=Ir("fnTypeSource",{args:null!=(v=s)?v:[],result:f})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i;var v;return Bt[h]={nextPos:zt,result:t},t}())===i&&(t=function(){var t,r,n,s,a,o,u,l,c=76*zt+67,f=Bt[c];if(f)return zt=f.nextPos,f.result;if(t=zt,(r=$r())!==i){for(n=[],s=Hr();s!==i;)n.push(s),s=Hr();if(60===e.charCodeAt(zt)?(s="<",zt++):(s=i,0===Zt&&Wt(Je)),s!==i){for(a=[],o=Hr();o!==i;)a.push(o),o=Hr();if((o=Or())!==i){for(u=[],l=Hr();l!==i;)u.push(l),l=Hr();62===e.charCodeAt(zt)?(l=">",zt++):(l=i,0===Zt&&Wt(Ze)),l!==i?(Ut=t,t=Ir("namedTypeSource",{name:r,inner:o})):(zt=t,t=i)}else zt=t,t=i}else zt=t,t=i}else zt=t,t=i;t===i&&(t=zt,(r=$r())!==i&&(Ut=t,r=function(e){return Ir("namedTypeSource",{name:e,inner:null})}(r)),t=r);return Bt[c]={nextPos:zt,result:t},t}()),Bt[r]={nextPos:zt,result:t},t)}function $r(){var t,r,n,s,a=76*zt+68,o=Bt[a];if(o)return zt=o.nextPos,o.result;if(t=zt,se.test(e.charAt(zt))?(r=e.charAt(zt),zt++):(r=i,0===Zt&&Wt(Pt)),r!==i){for(n=[],ae.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt(Ct));s!==i;)n.push(s),ae.test(e.charAt(zt))?(s=e.charAt(zt),zt++):(s=i,0===Zt&&Wt(Ct));Ut=t,t=Gt()}else zt=t,t=i;return Bt[a]={nextPos:zt,result:t},t}function Er(){var t,r,n,s,a,o=76*zt+70,u=Bt[o];if(u)return zt=u.nextPos,u.result;for(t=zt,r=[],n=Fr();n!==i;)r.push(n),n=Fr();if(44===e.charCodeAt(zt)?(n=j,zt++):(n=i,0===Zt&&Wt(je)),n!==i){for(s=[],a=Fr();a!==i;)s.push(a),a=Fr();t=r=[r,n,s]}else zt=t,t=i;if(t===i)if(t=[],(r=Fr())!==i)for(;r!==i;)t.push(r),r=Fr();else t=i;return Bt[o]={nextPos:zt,result:t},t}function Tr(){var t,r,n,s,a,o,u,l=76*zt+71,c=Bt[l];if(c)return zt=c.nextPos,c.result;if(t=zt,123===e.charCodeAt(zt)?(r=m,zt++):(r=i,0===Zt&&Wt(ge)),r!==i){for(n=[],s=Fr();s!==i;)n.push(s),s=Fr();for((s=rr())===i&&(s=null),a=[],o=Fr();o!==i;)a.push(o),o=Fr();125===e.charCodeAt(zt)?(o=x,zt++):(o=i,0===Zt&&Wt(me)),o!==i?(Ut=t,t=Ir("block",{statements:null!=(u=s)?u:[]})):(zt=t,t=i)}else zt=t,t=i;return t===i&&(t=ar()),Bt[l]={nextPos:zt,result:t},t}function Nr(){var t,r=76*zt+72,n=Bt[r];return n?(zt=n.nextPos,n.result):("\r\n"===e.substr(zt,2)?(t="\r\n",zt+=2):(t=i,0===Zt&&Wt(Mt)),t===i&&(oe.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=i,0===Zt&&Wt(kt))),Bt[r]={nextPos:zt,result:t},t)}function Dr(){var t,r,n=76*zt+73,s=Bt[n];return s?(zt=s.nextPos,s.result):(t=zt,Zt++,e.length>zt?(r=e.charAt(zt),zt++):(r=i,0===Zt&&Wt(ie)),Zt--,r===i?t=void 0:(zt=t,t=i),t===i&&(t=Nr()),Bt[n]={nextPos:zt,result:t},t)}function Fr(){var t,r=76*zt+74,n=Bt[r];return n?(zt=n.nextPos,n.result):(ue.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=i,0===Zt&&Wt(_t)),Bt[r]={nextPos:zt,result:t},t)}function Hr(){var t,r=76*zt+75,n=Bt[r];return n?(zt=n.nextPos,n.result):(le.test(e.charAt(zt))?(t=e.charAt(zt),zt++):(t=i,0===Zt&&Wt(jt)),Bt[r]={nextPos:zt,result:t},t)}function Ir(e,t,r){const n={type:e};t.children=r;for(const a of Object.keys(t))void 0!==t[a]&&(n[a]=t[a]);const s=Kt(Ut,zt);return n.loc={start:s.start.offset,end:s.end.offset-1},n}if((s=h())!==i&&zt===e.length)return s;throw s!==i&&zt<e.length&&Wt({type:"end"}),a=Jt,o=Lt<e.length?e.charAt(Lt):null,l=Lt<e.length?Kt(Lt,Lt+1):Kt(Lt,Lt),new fe(fe.buildMessage(a,o),a,o,l)}ie([l],ce.prototype,"exec",1),ie([l],ce.prototype,"execFn",1),ie([l],ce.prototype,"log",1),ie([l],ce.prototype,"collectNs",1),ie([l],ce.prototype,"collectNsMember",1),ie([l],ce.prototype,"_fn",1),ie([l],ce.prototype,"_eval",1),ie([l],ce.prototype,"_run",1),ie([l],ce.prototype,"registerAbortHandler",1),ie([l],ce.prototype,"unregisterAbortHandler",1),ie([l],ce.prototype,"abort",1),ie([l],ce.prototype,"assign",1),ie([l],ce,"collectMetadata",1),function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(fe,Error),fe.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,a=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(s):s,o=this.location.source+":"+a.line+":"+a.column;if(n){var u=this.location.end,l=he("",a.line.toString().length," "),i=n[s.line-1],c=(s.line===u.line?u.column:i.length+1)-s.column||1;t+="\n --\x3e "+o+"\n"+l+" |\n"+a.line+" | "+i+"\n"+l+" | "+he("",s.column-1," ")+he("",c,"^")}else t+="\n at "+o}return t},fe.buildMessage=function(e,t){var r,n={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?o(e[0])+"-"+o(e[1]):o(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function s(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+s(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+s(e)}))}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+s(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+s(e)}))}function u(e){return n[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(u);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(((r=t)?'"'+a(r)+'"':"end of input")+" found.")};const ve=["infix","if","fn","match","block","tmpl","str","num","bool","null","obj","arr","identifier","call","index","prop"];function de(e){return"chain"in e&&null!==e.chain}function ye(e,t,r){return{type:"index",target:e,index:t,loc:r}}function ge(e,t,r){return{type:"prop",target:e,name:t,loc:r}}function me(e,t){const r=t(e);switch(r.type){case"def":case"return":r.expr=me(r.expr,t);break;case"each":r.items=me(r.items,t),r.for=me(r.for,t);break;case"for":null!=r.from&&(r.from=me(r.from,t)),null!=r.to&&(r.to=me(r.to,t)),null!=r.times&&(r.times=me(r.times,t)),r.for=me(r.for,t);break;case"loop":for(let e=0;e<r.statements.length;e++)r.statements[e]=me(r.statements[e],t);break;case"addAssign":case"subAssign":case"assign":r.expr=me(r.expr,t),r.dest=me(r.dest,t);break;case"infix":for(let e=0;e<r.operands.length;e++)r.operands[e]=me(r.operands[e],t);break;case"not":r.expr=me(r.expr,t);break;case"if":r.cond=me(r.cond,t),r.then=me(r.then,t);for(const e of r.elseif)e.cond=me(e.cond,t),e.then=me(e.then,t);null!=r.else&&(r.else=me(r.else,t));break;case"fn":for(let e=0;e<r.children.length;e++)r.children[e]=me(r.children[e],t);break;case"match":r.about=me(r.about,t);for(const e of r.qs)e.q=me(e.q,t),e.a=me(e.a,t);null!=r.default&&(r.default=me(r.default,t));break;case"block":for(let e=0;e<r.statements.length;e++)r.statements[e]=me(r.statements[e],t);break;case"tmpl":for(let e=0;e<r.tmpl.length;e++){const n=r.tmpl[e];"string"!=typeof n&&(r.tmpl[e]=me(n,t))}break;case"obj":for(const e of r.value)r.value.set(e[0],me(e[1],t));break;case"arr":for(let e=0;e<r.value.length;e++)r.value[e]=me(r.value[e],t);break;case"callChain":for(let e=0;e<r.args.length;e++)r.args[e]=me(r.args[e],t);break;case"indexChain":r.index=me(r.index,t);break;case"call":r.target=me(r.target,t);for(let e=0;e<r.args.length;e++)r.args[e]=me(r.args[e],t);break;case"index":r.target=me(r.target,t),r.index=me(r.index,t);break;case"prop":r.target=me(r.target,t);break;case"ns":for(let e=0;e<r.members.length;e++)r.members[e]=me(r.members[e],t);break;case"or":case"and":r.left=me(r.left,t),r.right=me(r.right,t)}if(de(r)&&null!=r.chain)for(let n=0;n<r.chain.length;n++)r.chain[n]=me(r.chain[n],t);return r}const xe=["null","true","false","each","for","loop","break","continue","match","if","elif","else","return","eval","var","let","fn","namespace","meta","attr","attribute","static","class","struct","module","while","import","export"];function be(e){throw new O(`Reserved word "${e}" cannot be used as variable name.`)}function we(e){switch(e.type){case"def":case"attr":case"ns":case"identifier":case"propChain":xe.includes(e.name)&&be(e.name);break;case"meta":null!=e.name&&xe.includes(e.name)&&be(e.name);break;case"fn":for(const t of e.args)xe.includes(t.name)&&be(t.name)}return e}function Ae(e){for(const t of e)me(t,we);return e}function Pe(e){return{type:"simple",name:e}}function Ce(e){switch(e.type){case"namedTypeSource":if(e.inner){const t=Ce(e.inner);return`${e.name}<${t}>`}return e.name;case"fnTypeSource":return`@(${e.args.map((e=>Ce(e))).join(", ")}) { ${Ce(e.result)} }`}}function Me(e){if("namedTypeSource"===e.type){switch(e.name){case"null":case"bool":case"num":case"str":case"any":case"void":if(null==e.inner)return Pe(e.name);break;case"arr":case"obj":{let t;return t=null!=e.inner?Me(e.inner):Pe("any"),{type:"generic",name:e.name,inners:[t]}}}throw new O(`Unknown type: '${Ce(e)}'`)}{const n=e.args.map((e=>Me(e)));return t=n,r=Me(e.result),{type:"fn",args:t,result:r}}var t,r}function ke(e){switch(e.type){case"def":null!=e.varType&&Me(e.varType);break;case"fn":for(const t of e.args)null!=t.argType&&Me(t.argType);null!=e.retType&&Me(e.retType)}return e}function _e(e){for(const t of e)me(t,ke);return e}function je(e){const t=[],r=[];for(const n of e)if("attr"===n.type)r.push(n);else if("def"===n.type)null==n.attr&&(n.attr=[]),n.attr.push(...r),r.splice(0,r.length),"fn"===n.expr.type&&(n.expr.children=je(n.expr.children)),t.push(n);else{if(r.length>0)throw new O("invalid attribute.");switch(n.type){case"fn":n.children=je(n.children);break;case"block":n.statements=je(n.statements)}t.push(n)}if(r.length>0)throw new O("invalid attribute.");return t}function Se(e){if(u=e,ve.includes(u.type)&&de(e)&&null!=e.chain){const u=e,{chain:l}=u;let i=((e,t)=>{var r={};for(var o in e)s.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&n)for(var o of n(e))t.indexOf(o)<0&&a.call(e,o)&&(r[o]=e[o]);return r})(u,["chain"]);for(const e of l)switch(e.type){case"callChain":t=i,r=e.args,o=e.loc,i={type:"call",target:t,args:r,loc:o};break;case"indexChain":i=ye(i,e.index,e.loc);break;case"propChain":i=ge(i,e.name,e.loc)}return i}var t,r,o,u;return e}function Oe(e){for(let t=0;t<e.length;t++)e[t]=me(e[t],Se);return e}function $e(e,t,r){return{type:"infixTree",left:e,right:t,info:r}}function Ee(e,t,r){if("infixTree"!==e.type)return $e(e,t,r);if(r.priority<=e.info.priority)return $e(e,t,r);{const{left:n,right:s,info:a}=e;return $e(n,Ee(s,t,r),a)}}function Te(e){return"infixTree"!==e.type?e:e.info.mapFn?e.info.mapFn(e):{type:"call",target:{type:"identifier",name:e.info.func},args:[Te(e.left),Te(e.right)]}}const Ne={"*":{func:"Core:mul",priority:7},"^":{func:"Core:pow",priority:7},"/":{func:"Core:div",priority:7},"%":{func:"Core:mod",priority:7},"+":{func:"Core:add",priority:6},"-":{func:"Core:sub",priority:6},"==":{func:"Core:eq",priority:4},"!=":{func:"Core:neq",priority:4},"<":{func:"Core:lt",priority:4},">":{func:"Core:gt",priority:4},"<=":{func:"Core:lteq",priority:4},">=":{func:"Core:gteq",priority:4},"&&":{mapFn:e=>({type:"and",left:Te(e.left),right:Te(e.right)}),priority:3},"||":{mapFn:e=>({type:"or",left:Te(e.left),right:Te(e.right)}),priority:3}};function De(e){const t=e.operators.map((e=>{const t=Ne[e];if(null==t)throw new O(`No such operator: ${e}.`);return t}));let r=$e(e.operands[0],e.operands[1],t[0]);for(let n=0;n<t.length-1;n++)r=Ee(r,e.operands[2+n],t[1+n]);return Te(r)}function Fe(e){for(let t=0;t<e.length;t++)e[t]=me(e[t],(e=>"infix"===e.type?De(e):e));return e}class He{constructor(){this.plugins={validate:[Ae,_e],transform:[je,Oe,Fe]}}static parse(e){return null==He.instance&&(He.instance=new He),He.instance.parse(e)}addPlugin(e,t){switch(e){case"validate":this.plugins.validate.push(t);break;case"transform":this.plugins.transform.push(t);break;default:throw new Error("unknown plugin type")}}parse(e){let t;try{const r=pe(e,{startRule:"Preprocess"});t=pe(r,{startRule:"Main"})}catch(r){if(r.location)throw r.expected?new O(`Parsing error. (Line ${r.location.start.line}:${r.location.start.column})`):new O(`${r.message} (Line ${r.location.start.line}:${r.location.start.column})`);throw r}for(const n of this.plugins.validate)t=n(t);for(const n of this.plugins.transform)t=n(t);return t}}const Ie={id:"root"},qe=x("h1",null,"AiScript (v0.15.0) Playground",-1),ze={id:"grid1"},Ue={id:"editor",class:"container"},Re=M("Input"),Le={key:0,class:"syntaxError"},Je={id:"logs",class:"container"},Ze=x("header",null,"Output",-1),Be={class:"type"},Ge={id:"grid2"},Qe={id:"ast",class:"container"},Ve=x("header",null,"AST",-1),Ye=x("div",{id:"bin",class:"container"},[x("header",null,"Bytecode"),x("div")],-1),Ke=x("div",{id:"debugger",class:"container"},[x("header",null,"Debugger"),x("div")],-1);j({setup(e){const t=d(window.localStorage.getItem("script")||'<: "Hello, AiScript!"'),r=d(null),n=d([]),s=d(!1);y(t,(()=>{window.localStorage.setItem("script",t.value);try{r.value=He.parse(t.value),s.value=!1}catch(e){return s.value=!0,void console.error(e)}}),{immediate:!0});const a=()=>{t.value='for (let i, 100) {\n  <: if (i % 15 == 0) "FizzBuzz"\n    elif (i % 3 == 0) "Fizz"\n    elif (i % 5 == 0) "Buzz"\n    else i\n}'},o=async()=>{n.value=[];const e=new ce({},{in:e=>new Promise((t=>{t(window.prompt(e))})),out:e=>{n.value.push({id:Math.random(),type:e.type,text:"str"===e.type||"num"===e.type?e.value:te(e),print:!0})},log:(e,t)=>{switch(e){case"end":n.value.push({id:Math.random(),text:te(t.val,!0),print:!1})}}});try{await e.exec(r.value)}catch(t){console.error(t),window.alert("Error: "+t)}},u=e=>k.exports.highlight(e,k.exports.languages.js,"javascript");return(e,l)=>(g(),m("div",Ie,[qe,x("div",ze,[x("div",Ue,[x("header",null,[Re,x("div",{class:"actions"},[x("button",{onClick:a},"FizzBuzz")])]),x("div",null,[x(b(_),{class:"code",modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),highlight:u,"line-numbers":!1},null,8,["modelValue"])]),x("footer",null,[s.value?(g(),m("span",Le,"Syntax Error!")):w("",!0),x("div",{class:"actions"},[x("button",{onClick:o},"RUN")])])]),x("div",Je,[Ze,x("div",null,[(g(!0),m(A,null,P(n.value,(e=>(g(),m("div",{class:["log",[{print:e.print},e.type]],key:e.id},[x("span",Be,C(e.type),1),M(" "+C(e.text),1)],2)))),128))])])]),x("div",Ge,[x("div",Qe,[Ve,x("div",null,[x("pre",null,C(JSON.stringify(r.value,null,"\t")),1)])]),Ye,Ke])]))}}).mount("#app");
